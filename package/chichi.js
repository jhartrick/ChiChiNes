!function(t,s){"object"==typeof exports&&"object"==typeof module?module.exports=s(require("rxjs/Subject"),require("crc")):"function"==typeof define&&define.amd?define(["rxjs/Subject","crc"],s):"object"==typeof exports?exports.chichi=s(require("rxjs/Subject"),require("crc")):t.chichi=s(t.Rx,t.crc)}("undefined"!=typeof self?self:this,function(t,s){return function(t){var s={};function e(i){if(s[i])return s[i].exports;var r=s[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}return e.m=t,e.c=s,e.d=function(t,s,i){e.o(t,s)||Object.defineProperty(t,s,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var s=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(s,"a",s),s},e.o=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)},e.p="",e(e.s=10)}([function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),function(t){t[t.OneScreen=0]="OneScreen",t[t.Vertical=1]="Vertical",t[t.Horizontal=2]="Horizontal",t[t.FourScreen=3]="FourScreen"}(s.NameTableMirroring||(s.NameTableMirroring={}));class i{constructor(t){this.romFile=t,this.batterySRAM=!1,this.ramMask=8191,this.fileName="",this.oneScreenOffset=0,this.fourScreen=!1,this.mapperName="base",this.supported=!0,this.submapperId=0,this.mapsBelow6000=!1,this.nextEventAt=0,this.prgRomCount=0,this.chrRomOffset=0,this.chrRomCount=0,this.chrRamStart=0,this.chrRamLength=0,this.mapperId=0,this.chrRam=new Uint8Array(8192),this.prgRomBank6=new Uint8Array(8192),this.ppuBankStarts=new Uint32Array(16),this.prgBankStarts=new Uint32Array(10),this.SRAMCanWrite=!1,this.SRAMEnabled=!1,this.SRAMCanSave=!1,this.ROMHashFunction=null,this.mirroring=-1,this.updateIRQ=(()=>{this.NMIHandler()}),this.irqRaised=!1,this.usesSRAM=!1,this.loadFile(t)}setupMapperStateBuffer(t,s){}advanceClock(t){}get current6(){return this.prgBankStarts[0]/8192}get current8(){return this.prgBankStarts[2]/8192}get currentA(){return this.prgBankStarts[4]/8192}get currentC(){return this.prgBankStarts[6]/8192}get currentE(){return this.prgBankStarts[8]/8192}setupStateBuffer(t){return t.onRestore.subscribe(t=>{this.attachStateBuffer(t)}),t.pushSegment(8192,"prgram").pushSegment(10*Uint32Array.BYTES_PER_ELEMENT,"prgbankstarts").pushSegment(16*Uint32Array.BYTES_PER_ELEMENT,"ppubankstarts").pushSegment(0===this.romFile.chrRomCount?8192:0,"chrrom").pushSegment(8192,"chrram"),t}attachStateBuffer(t){let s=t.getSegment("prgram");this.prgRomBank6=new Uint8Array(s.buffer,s.start,s.size),s=t.getSegment("prgbankstarts"),this.prgBankStarts=new Uint32Array(s.buffer,s.start,10),s=t.getSegment("chrram"),this.chrRam=new Uint8Array(s.buffer,s.start,s.size),s=t.getSegment("ppubankstarts"),this.ppuBankStarts=new Uint32Array(s.buffer,s.start,16),(s=t.getSegment("chrrom")).size>0&&(this.chrRom=new Uint8Array(s.buffer,s.start,s.size))}loadFile(t){this.prgRomCount=t.prgRomCount,this.chrRomCount=t.chrRomCount,this.prgRom=t.prgRom,t.chrRomCount>0&&(this.chrRom=t.chrRom,this.chrRamStart=t.chrRomLength),this.chrRamLength=8192,this.usesSRAM=t.usesSRAM,this.batterySRAM=t.batterySRAM,this.ROMHashFunction=t.romCRC,this.mirroring=t.mirroring,this.fourScreen=t.fourScreen}installCart(t,s){this.Whizzler=t,this.CPU=s,this.prgRomBank6.fill(0);for(let t=0;t<16;t++)this.ppuBankStarts[t]=1024*t;for(let t=0;t<8;t++)this.prgBankStarts[t]=4096*t;this.mirroring=this.romFile.mirroring,this.mirror(0,this.mirroring),this.initializeCart()}getByte(t,s){let e=(s>>12)-6;return e<2?this.usesSRAM?this.prgRomBank6[s&this.ramMask]:s>>8&255:this.prgRom[this.prgBankStarts[e]+(4095&s)]}peekByte(t){return this.prgRom[this.prgBankStarts[(t>>12)-6]+(4095&t)]}setPrgRam(t,s){t>=24576&&t<=32767&&(this.prgRomBank6[8191&t]=s)}setByte(t,s,e){this.usesSRAM&&this.setPrgRam(s,e)}getPPUByte(t,s){const e=s>>10;let i=this.ppuBankStarts[e]+(1023&s);return e<8?this.chrRom[i]:this.chrRam[8191&i]}setPPUByte(t,s,e){const i=s>>10;let r=this.ppuBankStarts[i]+(1023&s);i<8?this.chrRom[r]=e:this.chrRam[8191&r]=e}setup6BankStarts(t,s,e,i,r){t%=2*this.prgRomCount,this.prgBankStarts[0]=8192*t,this.prgBankStarts[1]=this.prgBankStarts[0]+4096,this.setupBankStarts(s,e,i,r)}setupBankStarts(t,s,e,i){t%=2*this.prgRomCount,s%=2*this.prgRomCount,e%=2*this.prgRomCount,i%=2*this.prgRomCount,this.prgBankStarts[2]=8192*t,this.prgBankStarts[3]=this.prgBankStarts[2]+4096,this.prgBankStarts[4]=8192*s,this.prgBankStarts[5]=this.prgBankStarts[4]+4096,this.prgBankStarts[6]=8192*e,this.prgBankStarts[7]=this.prgBankStarts[6]+4096,this.prgBankStarts[8]=8192*i,this.prgBankStarts[9]=this.prgBankStarts[8]+4096}setupBanks4k(t,s){s=s.map(t=>t%(this.prgRomCount<<2));for(let e=0;e<s.length&&!(e>=this.prgBankStarts.length);++e)this.prgBankStarts[t+e]=4096*s[e]}maskBankAddress(t){return t%(2*this.prgRomCount)}mirror(t,s){switch(this.mirroring=s,s){case 0:this.ppuBankStarts[8]=this.chrRamStart+this.oneScreenOffset,this.ppuBankStarts[9]=this.chrRamStart+this.oneScreenOffset,this.ppuBankStarts[10]=this.chrRamStart+this.oneScreenOffset,this.ppuBankStarts[11]=this.chrRamStart+this.oneScreenOffset;break;case 1:this.ppuBankStarts[8]=this.chrRamStart+0,this.ppuBankStarts[9]=this.chrRamStart+1024,this.ppuBankStarts[10]=this.chrRamStart+0,this.ppuBankStarts[11]=this.chrRamStart+1024;break;case 2:this.ppuBankStarts[8]=this.chrRamStart+0,this.ppuBankStarts[9]=this.chrRamStart+0,this.ppuBankStarts[10]=this.chrRamStart+1024,this.ppuBankStarts[11]=this.chrRamStart+1024;break;case 3:this.ppuBankStarts[8]=this.chrRamStart+0,this.ppuBankStarts[9]=this.chrRamStart+1024,this.ppuBankStarts[10]=this.chrRamStart+2048,this.ppuBankStarts[11]=this.chrRamStart+3072}}copyBanks(t,s,e,i){s>=this.chrRomCount&&(s%=this.chrRomCount),e>=this.chrRomCount&&(e%=this.chrRomCount);const r=e<<3,a=s<<3;for(var h=0;h<i<<3;h++)this.ppuBankStarts[a+h]=1024*(r+h)}copyBanks4k(t,s,e,i){const r=this.chrRomCount<<1;s>=r&&(s%=r),e>=r&&(e%=r);const a=e<<2,h=s<<2;for(var n=0;n<i<<2;n++)this.ppuBankStarts[h+n]=1024*(a+n)}copyBanks2k(t,s,e,i){const r=this.chrRomCount<<2;s>=r&&(s%=r),e>=r&&(e%=r);for(var a=e<<1,h=s<<1,n=0;n<i<<1;n++)this.ppuBankStarts[h+n]=1024*(a+n)}copyBanks1k(t,s,e,i){const r=this.chrRomCount<<3;s>=r&&(s%=r),e>=r&&(e%=r);let a=e,h=s;for(var n=0;n<i;n++)this.ppuBankStarts[h+n]=1024*(a+n)}initializeCart(t){this.mirroring=this.romFile.mirroring,this.fourScreen=this.romFile.fourScreen,this.mirror(0,this.mirroring)}updateScanlineCounter(){}}s.BaseCart=i;s.UnsupportedCart=class extends i{constructor(){super(...arguments),this.supported=!1}initializeCart(){this.mapperName="unsupported",this.setupBankStarts(0,1,(this.prgRomCount<<1)-2,(this.prgRomCount<<1)-1),this.mirror(0,0)}}},function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});s.BufferMaker=class{static MakeUint32Array(t){return new Uint32Array(t)}static MakeUint8Array(t){return new Uint8Array(t)}},function(t){t[t.Unloaded=0]="Unloaded",t[t.Off=1]="Off",t[t.Running=2]="Running",t[t.Frozen=3]="Frozen",t[t.Paused=4]="Paused"}(s.RunningStatuses||(s.RunningStatuses={})),function(t){t[t.Instruction=0]="Instruction",t[t.Frame=1]="Frame"}(s.DebugStepTypes||(s.DebugStepTypes={})),function(t){t[t.Bullshit=0]="Bullshit",t[t.Implicit=1]="Implicit",t[t.Accumulator=2]="Accumulator",t[t.Immediate=3]="Immediate",t[t.ZeroPage=4]="ZeroPage",t[t.ZeroPageX=5]="ZeroPageX",t[t.ZeroPageY=6]="ZeroPageY",t[t.Relative=7]="Relative",t[t.Absolute=8]="Absolute",t[t.AbsoluteX=9]="AbsoluteX",t[t.AbsoluteY=10]="AbsoluteY",t[t.Indirect=11]="Indirect",t[t.IndexedIndirect=12]="IndexedIndirect",t[t.IndirectIndexed=13]="IndirectIndexed",t[t.IndirectZeroPage=14]="IndirectZeroPage",t[t.IndirectAbsoluteX=15]="IndirectAbsoluteX"}(s.ChiChiCPPU_AddressingModes||(s.ChiChiCPPU_AddressingModes={}));s.CpuStatus=class{constructor(){this.PC=0,this.A=0,this.X=0,this.Y=0,this.SP=0,this.SR=0}};s.PpuStatus=class{constructor(){this.status=0,this.controlByte0=0,this.controlByte1=0,this.nameTableStart=0,this.currentTile=0,this.lockedVScroll=0,this.lockedHScroll=0,this.X=0,this.Y=0}};s.ChiChiInstruction=class{constructor(){this.AddressingMode=0,this.frame=0,this.time=0,this.A=0,this.X=0,this.Y=0,this.SR=0,this.SP=0,this.Address=0,this.OpCode=0,this.Parameters0=0,this.Parameters1=0,this.ExtraTiming=0,this.Length=0}};s.ChiChiSprite=class{constructor(){this.YPosition=0,this.XPosition=0,this.SpriteNumber=0,this.Foreground=!1,this.IsVisible=!1,this.TileIndex=0,this.AttributeByte=0,this.FlipX=!1,this.FlipY=!1,this.Changed=!1}}},function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const i=e(12),r=e(13),a=e(14),h=e(15);class n{constructor(t){this.writer=t,this.frameMode=!1,this.pulseTable=[],this.tndTable=[],this.throwingIRQs=!1,this.reg15=0,this._sampleRate=44100,this.muted=!1,this.lastFrameHit=0,this.currentClock=0,this.frameClocker=0,this._interruptRaised=!1,this.sequence4=[7457,14913,22371,29828,29829,29831],this.sequence5=[7457,14913,22371,29828,37282,37283],this.lastOutput=0,this.rebuildSound();for(let t=0;t<31;++t)this.pulseTable.push(95.52/(8128/t+100));for(let t=0;t<203;++t)this.tndTable.push(163.67/(24329/t+100))}irqHandler(){}set audioSettings(t){this.noise.playing=t.enableNoise,this.dmc.playing=t.enableDMC,this.square0.playing=t.enableSquare0,this.square1.playing=t.enableSquare1,this.triangle.playing=t.enableTriangle,this.writer.synced=t.synced,t.sampleRate!=this._sampleRate&&(this._sampleRate=t.sampleRate)}get audioSettings(){return{sampleRate:this._sampleRate,master_volume:1,enableSquare0:this.square0.playing,enableSquare1:this.square1.playing,enableTriangle:this.triangle.playing,enableNoise:this.noise.playing,enableDMC:this.dmc.playing,synced:this.writer.synced}}get sampleRate(){return this._sampleRate}set sampleRate(t){this._sampleRate=t,this.rebuildSound()}get interruptRaised(){return this._interruptRaised||this.dmc.interruptRaised}set interruptRaised(t){this._interruptRaised=t}rebuildSound(){this.writer.blip_new(this._sampleRate/5),this.writer.blip_set_rates(n.clock_rate,this._sampleRate),this.writer.audioBytesWritten=0,this.square0=new r.SquareChannel(0,t=>this.mixAndOutputAudio(t)),this.square0.period=10,this.square0.sweepComplement=!0,this.square1=new r.SquareChannel(1,t=>this.mixAndOutputAudio(t)),this.square1.period=10,this.square1.sweepComplement=!1,this.triangle=new a.TriangleChannel(2,t=>this.mixAndOutputAudio(t)),this.triangle.period=0,this.noise=new h.NoiseChannel(3,t=>this.mixAndOutputAudio(t)),this.noise.period=0,this.dmc=new i.DMCChannel(4,t=>this.mixAndOutputAudio(t),t=>(this.memoryMap.cpu.borrowedCycles+=4,this.memoryMap.getByte(0,t)))}GetByte(t,s){if(16384===s&&(this._interruptRaised=!1),16405===s){const t=(this.dmc.interruptRaised?128:0)|(this.interruptRaised?64:0)|(this.dmc.length>0?16:0)|(this.square0.length>0?1:0)|(this.square1.length>0?2:0)|(this.triangle.length>0?4:0)|(this.square0.length>0?8:0)|(this._interruptRaised?64:0);return this.interruptRaised=!1,t}return 66}SetByte(t,s,e){switch(16384===s&&(this._interruptRaised=!1),s){case 16384:case 16385:case 16386:case 16387:this.square0.writeRegister(s-16384,e,t);break;case 16388:case 16389:case 16390:case 16391:this.square1.writeRegister(s-16388,e,t);break;case 16392:case 16393:case 16394:case 16395:this.triangle.writeRegister(s-16392,e,t);break;case 16396:case 16397:case 16398:case 16399:this.noise.writeRegister(s-16396,e,t);break;case 16400:case 16401:case 16402:case 16403:this.dmc.writeRegister(s-16400,e,t),this.dmc.run(this.currentClock);break;case 16405:this.reg15=e,this.square0.writeRegister(4,1&e,t),this.square1.writeRegister(4,2&e,t),this.triangle.writeRegister(4,4&e,t),this.noise.writeRegister(4,8&e,t),this.dmc.writeRegister(4,16&e,t);break;case 16407:this.throwingIRQs=64!=(64&e),this.frameMode=128==(128&e),this.memoryMap.cpu.borrowedCycles+=2}}advanceClock(t){this.currentClock+=t,this.frameClocker+=t;const s=this.frameMode?this.sequence5[this.lastFrameHit]:this.sequence4[this.lastFrameHit];this.frameClocker>=s&&this.updateFrame(this.currentClock)}updateFrame(t){this.runFrameEvents(t,this.lastFrameHit),this.lastFrameHit>=(this.frameMode?4:3)?(this.lastFrameHit=0,this.frameClocker=0,this.endFrame(t),this.throwingIRQs&&!this.frameMode&&(this._interruptRaised=!0,this.irqHandler())):this.lastFrameHit++}runFrameEvents(t,s){this.triangle.frameClock(t,s),this.noise.frameClock(t,s),this.square0.frameClock(t,s),this.square1.frameClock(t,s)}endFrame(t){this.square0.endFrame(t),this.square1.endFrame(t),this.triangle.endFrame(t),this.noise.endFrame(t),this.dmc.endFrame(t),this.writer.blip_end_frame(t),this.writer.readElementsLoop(),this.currentClock=0}mixAndOutputAudio(t){let s=this.pulseTable[this.square0.output+this.square1.output];const e=65536*(s+=this.tndTable[3*this.triangle.output+2*this.noise.output+this.dmc.output])-this.lastOutput;this.lastOutput+=e,this.writer.blip_add_delta(t,e)}}n.clock_rate=1789772.727,s.ChiChiAPU=n},function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const i=e(1),r=64,a=new Uint32Array([7961465,10626572,11407400,10554206,7733552,2753820,725017,271983,278855,284436,744967,3035906,7161605,0,131586,131586,12566719,14641430,15614283,14821245,12196292,6496468,2176980,875189,293472,465210,1597716,5906953,11090185,2961197,197379,197379,16316149,16298569,16588080,16415170,15560682,12219892,7115511,4563694,2277591,2151458,4513360,1957181,14604331,6579811,263172,263172,16447992,16441012,16634316,16500447,16236786,14926838,12831991,11393781,2287340,5500370,11858360,14283440,15921318,13158344,328965,328965,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);s.ChiChiPPU=class{constructor(){this.LastcpuClock=0,this.greyScale=!1,this.yPosition=0,this.xPosition=0,this.currentAttributeByte=0,this.spriteSize=0,this.spritesOnThisScanline=0,this._spriteCopyHasHappened=!1,this.spriteZeroHit=!1,this.emphasisBits=0,this.isForegroundPixel=!1,this.spriteChanges=!1,this.ppuReadBuffer=0,this.clipSprites=!1,this.clipTiles=!1,this.tilesVisible=!1,this.spritesVisible=!1,this.nameTableMemoryStart=0,this.backgroundPatternTableIndex=0,this.address=0,this.status=0,this.controlByte0=0,this.controlByte1=0,this.spriteAddress=0,this.currentXPosition=0,this.currentYPosition=0,this.hScroll=0,this.vScroll=0,this.lockedHScroll=0,this.lockedVScroll=0,this.shouldRender=!1,this.framesRun=0,this.hitSprite=!1,this.addressLatchIsHigh=!0,this.isRendering=!0,this.frameClock=0,this.oddFrame=!0,this.frameOn=!1,this.nameTableBits=0,this.palette=new Uint8Array(32),this.openBus=0,this.xNTXor=0,this.yNTXor=0,this.spriteRAMBuffer=new ArrayBuffer(256*Uint8Array.BYTES_PER_ELEMENT),this.spriteRAM=new Uint8Array(this.spriteRAMBuffer),this.spritesOnLine=new Array(512),this.currentTileIndex=0,this.fetchTile=!0,this.patternEntry=0,this.patternEntryByte2=0,this.pixelBuffer=h()(new ArrayBuffer(262144)),this.initSprites()}GetPPUStatus(){return{status:this.status,controlByte0:this.controlByte0,controlByte1:this.controlByte1,nameTableStart:this.nameTableMemoryStart,currentTile:this.currentTileIndex,lockedVScroll:this.lockedVScroll,lockedHScroll:this.lockedHScroll,X:this.currentXPosition,Y:this.currentYPosition}}get PatternTableIndex(){return this.backgroundPatternTableIndex}get SpritePatternTableIndex(){let t=0;return 32==(32&this.controlByte0)&&(t=4096),t}initialize(){this.address=0,this.status=0,this.controlByte0=0,this.controlByte1=0,this.hScroll=0,this.vScroll=0,this.spriteAddress=0,this.initSprites()}setupVINT(){this.status=128|this.status,this.framesRun=this.framesRun+1,128&this.controlByte0&&(this.cpu.handleNMI=!0)}setByte(t,s,e){switch(7&s){case 0:this.controlByte0=e,this.openBus=e,this.nameTableBits=3&this.controlByte0,this.backgroundPatternTableIndex=4096*((16&this.controlByte0)>>4),this.nameTableMemoryStart=1024*this.nameTableBits;break;case 1:this.isRendering=0!=(24&e),this.controlByte1=e,this.emphasisBits=this.controlByte1>>5&7,this.greyScale=1==(1&this.controlByte1),this.clipTiles=2!=(2&this.controlByte1),this.clipSprites=4!=(4&this.controlByte1),this.tilesVisible=8==(8&this.controlByte1),this.spritesVisible=16==(16&this.controlByte1);break;case 2:this.ppuReadBuffer=e,this.openBus=e;break;case 3:this.spriteAddress=255&e,this.openBus=this.spriteAddress;break;case 4:this.spriteRAM[this.spriteAddress]=e,this.spriteAddress=this.spriteAddress+1&255,this.unpackedSprites[this.spriteAddress>>2].Changed=!0,this.spriteChanges=!0;break;case 5:this.addressLatchIsHigh?(this.hScroll=e,this.lockedHScroll=7&this.hScroll,this.addressLatchIsHigh=!1):(this.vScroll=e,e>240&&(this.vScroll=e-256),(!this.frameOn||this.frameOn&&!this.isRendering)&&(this.lockedVScroll=this.vScroll),this.addressLatchIsHigh=!0,this.updatePixelInfo());break;case 6:this.addressLatchIsHigh?(this.address=255&this.address|(63&e)<<8,this.addressLatchIsHigh=!1):(this.address=32512&this.address|255&e,this.addressLatchIsHigh=!0,this.hScroll=(31&this.address)<<3,this.vScroll=(this.address>>5&31)<<3,this.vScroll|=this.address>>12&3,this.frameOn&&(this.lockedHScroll=this.hScroll,this.lockedVScroll=this.vScroll,this.lockedVScroll=this.lockedVScroll-this.currentYPosition),this.nameTableBits=this.address>>10&3,this.nameTableMemoryStart=1024*this.nameTableBits);break;case 7:if(16128==(65280&this.address)){const t=31&this.address;this.palette[t]=e,16128==(65519&this.address)&&(this.palette[31&(16^t)]=e)}else this.memoryMap.setPPUByte(t,this.address,e);4==(4&this.controlByte0)?this.address=this.address+32:this.address=this.address+1,this.addressLatchIsHigh=!0,this.address=16383&this.address}}getByte(t,s){switch(7&s){case 3:case 0:case 1:case 5:case 6:return this.openBus;case 2:let e=0;return this.addressLatchIsHigh=!0,128==(128&(e=31&this.ppuReadBuffer|this.status))&&(this.status=-129&this.status),e;case 4:return this.spriteRAM[this.spriteAddress];case 7:let i=0;return 16128==(65280&this.address)?(i=this.palette[31&this.address],this.ppuReadBuffer=this.memoryMap.getPPUByte(t,this.address-4096)):(i=this.ppuReadBuffer,this.address>=8192&&this.address<=12287?this.ppuReadBuffer=this.memoryMap.getPPUByte(t,this.address):this.ppuReadBuffer=this.memoryMap.getPPUByte(t,16383&this.address)),4==(4&this.controlByte0)?this.address=this.address+32:this.address=this.address+1,this.address=16383&this.address,i}return 0}copySprites(t){for(var s=0;s<256;++s){var e=this.spriteAddress+s&255;this.spriteRAM[e]!==this.memoryMap.Rams[t+s]&&(this.spriteRAM[e]=this.memoryMap.Rams[t+s],this.unpackedSprites[e>>2&255].Changed=!0)}this._spriteCopyHasHappened=!0,this.spriteChanges=!0}initSprites(){this.currentSprites=new Array(r);for(let t=0;t<r;++t)this.currentSprites[t]=new i.ChiChiSprite;this.unpackedSprites=new Array(64);for(let t=0;t<64;++t)this.unpackedSprites[t]=new i.ChiChiSprite}getSpritePixel(){this.isForegroundPixel=!1,this.spriteZeroHit=!1;let t=0,s=0,e=0,i=0;for(let r=0;r<this.spritesOnThisScanline;++r){let a=this.currentSprites[r];if(a.XPosition>0&&this.currentXPosition>=a.XPosition&&this.currentXPosition<a.XPosition+8){let r=0;8==(8&this.controlByte0)&&(r=4096),e=this.currentXPosition-a.XPosition,s=this.currentYPosition-a.YPosition-1,s&=this.spriteSize-1,i=a.TileIndex,32==(32&this.controlByte0)&&(1==(1&i)?(r=4096,i^=1):r=0);let h=0,n=0;if(a.FlipY&&(s=this.spriteSize-s-1),s>=8&&(s+=8),h=this.memoryMap.getPPUByte(0,r+16*i+s),n=this.memoryMap.getPPUByte(0,r+16*i+s+8),0!=(t=255&(a.FlipX?h>>e&1|n>>e<<1&2:h>>7-e&1|n>>7-e<<1&2)))return 0===a.SpriteNumber&&(this.spriteZeroHit=!0),this.isForegroundPixel=a.Foreground,t|a.AttributeByte}}return 0}decodeSpritePixel(t,s,e,i,r){let a=0,h=0;i.v.FlipY&&(e=this.spriteSize-e-1),e>=8&&(e+=8);const n=t+(r<<4)+e;return a=this.memoryMap.getPPUByte(this.LastcpuClock,n),h=this.memoryMap.getPPUByte(this.LastcpuClock,n+8),i.v.FlipX?a>>s&1|h>>s<<1&2:a>>7-s&1|h>>7-s<<1&2}preloadSprites(t){this.spritesOnThisScanline=0,this.currentYPosition;for(let s=0;s<256;s+=4){const e=(s+this.spriteAddress&255)>>2,i=this.unpackedSprites[e].YPosition+1;if(t>=i&&t<i+this.spriteSize&&(this.currentSprites[this.spritesOnThisScanline]=this.unpackedSprites[e],this.currentSprites[this.spritesOnThisScanline].IsVisible=!0,this.spritesOnThisScanline++,this.spritesOnThisScanline===r))break}this.spritesOnThisScanline>7&&(this.status=32|this.status)}unpackSprites(){for(var t=0;t<this.unpackedSprites.length;++t)this.unpackedSprites[t].Changed&&this.unpackSprite(t)}unpackSprite(t){const s=this.spriteRAM[2+(t<<2)|0];this.unpackedSprites[t].IsVisible=!0,this.unpackedSprites[t].AttributeByte=(3&s)<<2|16,this.unpackedSprites[t].YPosition=this.spriteRAM[4*t],this.unpackedSprites[t].XPosition=this.spriteRAM[4*t+3],this.unpackedSprites[t].SpriteNumber=t,this.unpackedSprites[t].Foreground=32!=(32&s),this.unpackedSprites[t].FlipX=64==(64&s),this.unpackedSprites[t].FlipY=128==(128&s),this.unpackedSprites[t].TileIndex=this.spriteRAM[4*t+1],this.unpackedSprites[t].Changed=!1}getNameTablePixel(){var t=(128&this.patternEntry)>>7|(128&this.patternEntryByte2)>>6;return this.patternEntry<<=1,this.patternEntryByte2<<=1,t>0&&(t|=this.currentAttributeByte),255&t}getAttrEntry(t,s,e){const i=this.memoryMap.getPPUByte(0,8192+t+960+(s>>2)+8*(e>>2));switch(2&s|2*(2&e)){case 0:return i<<2&12;case 2:return 12&i;case 4:return i>>2&12;case 6:return i>>4&12}return 0}advanceClock(t){let s=3*t;if(this.frameClock>89002){if(this.frameClock+=s,!(this.frameClock>89342))return;s=this.frameClock-89342}for(;s--;){switch(this.frameClock){case 0:this.shouldRender=!0,this.pixelBuffer.reset(),this.currentXPosition=0,this.currentYPosition=0,this.xNTXor=0,this.yNTXor=0,0!=(24&this.controlByte1)&&(this.oddFrame=!this.oddFrame,this.isRendering=!0);break;case 81840:this.shouldRender=!1,this.frameFinished(),this.frameOn=!1;break;case 82523:this.setupVINT();break;case 89002:this.status=0,this.hitSprite=!1,this.spriteSize=32==(32&this.controlByte0)?16:8,this.spriteChanges&&(this.unpackSprites(),this.spriteChanges=!1),this.frameOn=!0,this.oddFrame&&this.frameClock++}this.frameOn&&this.renderPixel(this.LastcpuClock+t),this.frameClock++,this.frameClock>=89342&&(this.frameClock=0)}}renderPixel(t){if(this.currentXPosition<256&&this.currentYPosition<=240){if(this.xPosition=this.currentXPosition+this.lockedHScroll,0==(7&this.xPosition)){this.xNTXor=256&this.xPosition?1024:0,this.xPosition&=255;let s=this.nameTableMemoryStart^this.xNTXor^this.yNTXor,e=this.xPosition>>3;const i=8192+s+e+((this.yPosition>>3)%30<<5);let r=this.memoryMap.getPPUByte(t,i),a=7&this.yPosition,h=this.backgroundPatternTableIndex+16*r+a;this.patternEntry=this.memoryMap.getPPUByte(t,h),this.patternEntryByte2=this.memoryMap.getPPUByte(t,h+8),this.currentAttributeByte=this.getAttrEntry(s,e,this.yPosition>>3)}let s=this.tilesVisible,e=this.spritesVisible;this.currentXPosition<8&&(e=(s=s&&!this.clipTiles)&&!this.clipSprites),this.spriteZeroHit=!1;const i=s?this.getNameTablePixel():0,r=e?this.getSpritePixel():0;!this.hitSprite&&this.spriteZeroHit&&0!==i&&(this.hitSprite=!0,this.status=64|this.status);const a=this.palette[this.isForegroundPixel||0===i&&0!==r?r:i];this.pixelBuffer.draw(a)}this.currentXPosition++,this.currentXPosition>340&&(this.currentXPosition=0,this.currentYPosition++,this.preloadSprites(this.currentYPosition),this.spritesOnThisScanline>=7&&(this.status=32|this.status),this.lockedHScroll=this.hScroll,this.memoryMap.advanceScanline(1),this.updatePixelInfo(),this.yPosition=this.currentYPosition+this.lockedVScroll,this.yPosition<0&&(this.yPosition+=240),this.yPosition>=240?(this.yPosition-=240,this.yNTXor=2048):this.yNTXor=0)}updatePixelInfo(){this.nameTableMemoryStart=1024*this.nameTableBits}setupStateBuffer(t){return t.onRestore.subscribe(t=>{this.attachStateBuffer(t)}),t.onUpdateBuffer.subscribe(t=>{this.updateStateBuffer(t)}),t.pushSegment(256*Uint8Array.BYTES_PER_ELEMENT,"spriteram").pushSegment(2,"ppuaddress").pushSegment(2,"spriteaddress").pushSegment(2,"ppucontrolbytes").pushSegment(2,"ppustatus").pushSegment(2,"hvscroll").pushSegment(2,"lockedhvscroll"),t}attachStateBuffer(t){this.spriteRAM=t.getUint8Array("spriteram"),this.address=t.getUint16Array("ppuaddress")[0],this.spriteAddress=t.getUint8Array("spriteaddress")[0];const s=t.getUint8Array("ppucontrolbytes");this.controlByte0=s[0],this.controlByte1=s[1],this.status=t.getUint8Array("ppustatus")[0];const e=t.getUint8Array("hvscroll");this.hScroll=e[0],this.vScroll=e[1];const i=t.getUint8Array("lockedhvscroll");this.lockedHScroll=i[0],this.lockedVScroll=i[1],this.nameTableBits=3&this.controlByte0,this.backgroundPatternTableIndex=4096*((16&this.controlByte0)>>4),this.greyScale=1==(1&this.controlByte1),this.emphasisBits=this.controlByte1>>5&7,this.spritesVisible=16==(16&this.controlByte1),this.tilesVisible=8==(8&this.controlByte1),this.clipTiles=2!=(2&this.controlByte1),this.clipSprites=4!=(4&this.controlByte1)}updateStateBuffer(t){t.getUint16Array("ppuaddress")[0]=this.address,t.getUint8Array("spriteaddress")[0]=this.spriteAddress;const s=t.getUint8Array("ppucontrolbytes");s[0]=this.controlByte0,s[1]=this.controlByte1,t.getUint8Array("ppustatus")[0]=this.status;const e=t.getUint8Array("hvscroll");e[0]=this.hScroll,e[1]=this.vScroll;const i=t.getUint8Array("lockedhvscroll");i[0]=this.lockedHScroll,i[1]=this.lockedVScroll}};const h=(t=a)=>s=>{let e=0;new Uint8Array(s);const i=new Uint32Array(s);return{reset:()=>{e=0},buffer:s,draw:s=>{i[e++]=4278190080|t[63&s]}}};s.PixelBuffers={createRawPixelBuffer:t=>{let s=0;const e=new Uint8Array(t);return{reset:()=>{s=0},buffer:t,draw:t=>{e[4*s]=t,s++}}},createDecodedPixelBuffer:h}},function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const i=0,r=2,a=2097152,h=18,n=32,o=21,c=15,u=[[43,-115,350,-488,1136,-914,5861,21022],[44,-118,348,-473,1076,-799,5274,21001],[45,-121,344,-454,1011,-677,4706,20936],[46,-122,336,-431,942,-549,4156,20829],[47,-123,327,-404,868,-418,3629,20679],[47,-122,316,-375,792,-285,3124,20488],[47,-120,303,-344,714,-151,2644,20256],[46,-117,289,-310,634,-17,2188,19985],[46,-114,273,-275,553,117,1758,19675],[44,-108,255,-237,471,247,1356,19327],[43,-103,237,-199,390,373,981,18944],[42,-98,218,-160,310,495,633,18527],[40,-91,198,-121,231,611,314,18078],[38,-84,178,-81,153,722,22,17599],[36,-76,157,-43,80,824,-241,17092],[34,-68,135,-3,8,919,-476,16558],[32,-61,115,34,-60,1006,-683,16001],[29,-52,94,70,-123,1083,-862,15422],[27,-44,73,106,-184,1152,-1015,14824],[25,-36,53,139,-239,1211,-1142,14210],[22,-27,34,170,-290,1261,-1244,13582],[20,-20,16,199,-335,1301,-1322,12942],[18,-12,-3,226,-375,1331,-1376,12293],[15,-4,-19,250,-410,1351,-1408,11638],[13,3,-35,272,-439,1361,-1419,10979],[11,9,-49,292,-464,1362,-1410,10319],[9,16,-63,309,-483,1354,-1383,9660],[7,22,-75,322,-496,1337,-1339,9005],[6,26,-85,333,-504,1312,-1280,8355],[4,31,-94,341,-507,1278,-1205,7713],[3,35,-102,347,-506,1238,-1119,7082],[1,40,-110,350,-499,1190,-1021,6464],[0,43,-115,350,-488,1136,-914,5861]];class p{constructor(){this.neswait=!1,this.synced=!0,this.controlBuffer=new Int32Array(new ArrayBuffer(3*Int32Array.BYTES_PER_ELEMENT)),this.sharedAudioBufferPos=0,this.SharedBufferLength=8192,this.chunkSize=1024,this.SharedBuffer=new Float32Array(this.SharedBufferLength)}get bufferPosition(){return this.controlBuffer[r]}get audioBytesWritten(){return this.controlBuffer[i]}set audioBytesWritten(t){this.controlBuffer[i]=t}wakeSleepers(){this.neswait=!1}synchronize(){this.synced?this.audioBytesWritten>=this.chunkSize&&(this.controlBuffer[r]=this.sharedAudioBufferPos,this.neswait=!0):this.audioBytesWritten=this.chunkSize}}p.sample_size=1,s.WavSharer=p;s.ChiChiWavSharer=class extends p{constructor(t){super(),t.onRestore.subscribe(t=>{this.SharedBuffer=t.getFloat32Array("abuffer")}),this.blip_new(8820)}blip_new(t){this.blipBuffer=new l(t+h),this.blipBuffer.size=t,this.blipBuffer.factor=0,this.blip_clear()}blip_set_rates(t,s){this.blipBuffer.factor=a/t*s+.9999847412109375}blip_clear(){this.blipBuffer.offset=0,this.blipBuffer.avail=0,this.blipBuffer.integrator=0}blip_end_frame(t){let s=t*this.blipBuffer.factor+this.blipBuffer.offset;this.blipBuffer.avail+=s>>o,this.blipBuffer.offset=s&a-1}remove_samples(t){let s=this.blipBuffer.avail+h-t;this.blipBuffer.avail-=t,this.blipBuffer.samples.copyWithin(0,t,t+s),this.blipBuffer.samples.fill(0,s,s+t),this.blipBuffer.arrayLength=t}readElementsLoop(){let t=this.SharedBuffer,s=this.sharedAudioBufferPos,e=this.blipBuffer.avail,i=0,r=s,a=e,h=this.blipBuffer.integrator,n=1,o=1*n-1;if(n*=1/32768,0!==e){do{let s=h>>c;h+=this.blipBuffer.samples[i],i++,++r>=t.length&&(r=0),t[r]=s*n+o,h-=s<<7}while(a-- >0);this.blipBuffer.integrator=h,this.remove_samples(e)}return this.sharedAudioBufferPos=r,this.audioBytesWritten+=e,this.synchronize(),e}blip_add_delta(t,s){if(0===s)return;const e=t*this.blipBuffer.factor+this.blipBuffer.offset|0,i=this.blipBuffer.avail+(e>>o),r=(e>>16&n-1)>>>0,a=r,h=n-r,c=s*(e>>1&32767)>>15;s-=c;for(let t=0;t<8;++t)this.blipBuffer.samples[i+t]+=u[a][t]*s+u[a][t]*c,this.blipBuffer.samples[i+(15-t)]+=u[h][t]*s+u[h-1][t]*c}};class l{constructor(t){this.size=t,this.factor=0,this.offset=0,this.avail=0,this.integrator=0,this.time_bits=0,this.arrayLength=0,this.samples=new Array(t),this.samples.fill(0)}}},function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const i=e(1),r=0,a=1,h=1,n=4,o=8,c=64,u=[7,6,0,0,3,2,5,0,3,2,2,0,6,4,6,0,2,5,0,0,3,3,6,0,2,4,2,0,6,4,7,0,6,6,0,0,3,2,5,0,3,2,2,0,4,4,6,0,2,5,0,0,3,3,6,0,2,4,2,0,6,4,7,0,6,6,0,0,3,2,5,0,3,2,2,0,3,4,6,0,2,5,0,0,0,3,6,0,2,4,2,0,6,4,6,0,6,6,0,0,3,3,5,0,3,2,2,0,5,4,6,0,2,5,0,0,0,4,6,0,2,4,2,0,6,4,7,0,3,6,3,0,3,3,3,0,2,3,2,0,4,4,4,0,2,6,0,0,4,4,4,0,2,5,2,0,0,5,0,0,2,6,2,0,3,3,3,0,2,2,2,0,4,4,4,0,2,5,0,0,4,4,4,0,2,4,2,0,4,4,4,0,2,6,3,0,3,2,5,0,2,2,2,0,4,4,6,0,2,5,0,0,3,4,6,0,2,4,2,0,6,4,7,0,2,6,3,0,3,3,5,0,2,2,2,0,4,4,6,0,2,5,0,0,3,4,6,0,2,4,2,0,6,4,7,0],p=[1,12,1,0,0,4,4,0,1,3,2,3,8,8,8,1,7,13,14,1,4,5,5,1,1,10,1,1,8,9,9,1,8,12,1,1,4,4,4,1,1,3,2,3,8,8,8,1,7,13,14,1,5,5,5,1,1,10,1,1,9,9,9,1,1,12,1,1,1,4,4,1,1,3,2,3,8,8,8,1,7,13,14,1,1,5,5,1,1,10,1,1,1,9,9,1,1,12,1,1,4,4,4,1,1,3,2,3,11,8,8,1,7,13,14,1,5,5,5,1,1,10,1,1,15,9,9,1,7,12,3,1,4,4,4,1,1,3,1,1,8,8,8,1,7,13,14,1,5,5,6,1,1,10,1,1,8,9,9,1,3,12,3,1,4,4,4,1,1,3,1,3,8,8,8,1,7,13,14,1,5,5,6,1,1,10,1,1,9,9,10,1,3,12,3,1,4,4,4,1,1,3,1,3,8,8,8,1,7,13,14,1,1,5,5,1,1,10,1,1,1,9,9,1,3,12,3,1,4,4,4,1,1,3,1,3,8,8,8,1,7,13,14,1,1,5,5,1,1,10,1,1,1,9,9,1];function l(t,s){t.cpuStatus=s.getUint8Array("cpu_status"),t.cpuStatus16=s.getUint16Array("cpu_status_16")}function d(t,s){t.cpuStatus16[r]=t.programCounter,t.cpuStatus16[a]=t.addressBus,t.cpuStatus[0]=t.statusRegister,t.cpuStatus[1]=t.accumulator,t.cpuStatus[2]=t.indexRegisterX,t.cpuStatus[3]=t.indexRegisterY,t.cpuStatus[4]=t.dataBus,t.cpuStatus[5]=t.stackPointer}s.ChiChiCPPU=class{constructor(t,s){var e,r;this.clock=0,this.borrowedCycles=0,this.cpuStatus16=new Uint16Array(2),this.programCounter=0,this.addressBus=0,this.handleNMI=!1,this.cpuStatus=new Uint8Array(8),this.stackPointer=255,this.statusRegister=0,this.accumulator=0,this.indexRegisterX=0,this.indexRegisterY=0,this.dataBus=0,this._operationCounter=0,this._currentInstruction_AddressingMode=i.ChiChiCPPU_AddressingModes.Bullshit,this._currentInstruction_Address=0,this._currentInstruction_OpCode=0,this._currentInstruction_Parameters0=0,this._currentInstruction_Parameters1=0,this._currentInstruction_ExtraTiming=0,this.systemClock=0,this.instructionUsage=new Uint32Array(256),this.debugging=!1,this.cheating=!1,this.genieCodes=new Array,this.instructionHistoryPointer=255,this._instructionHistory=new Array(256),this.setupStateBuffer=(t=>(e=this,t=t,t.onRestore.subscribe(t=>{l(e,t)}),t.onUpdateBuffer.subscribe(t=>{d(e,t)}),t.pushSegment(2*Uint16Array.BYTES_PER_ELEMENT,"cpu_status_16").pushSegment(8,"cpu_status"),t)),this.SoundBopper=t,this.ppu=s;for(let t=0;t<this._instructionHistory.length;++t)this._instructionHistory[t]=new i.ChiChiInstruction}advanceClock(t){t&&(this.memoryMap.advanceClock(t),this.clock+=t)}cheat(t,s){let e=this.genieCodes.find(s=>s.address==t);return e?(e.data>255?e.data>>8==s&&(s=255&e.data):s=e.data,s):s}get InstructionHistory(){return this._instructionHistory}get InstructionHistoryPointer(){return this.instructionHistoryPointer}get Clock(){return this.clock}set Clock(t){this.advanceClock(t),this.clock=t}setFlag(t,s){this.statusRegister=s?this.statusRegister|t:this.statusRegister&~t,this.statusRegister|=32}GetFlag(t){return(this.statusRegister&t)===t}interruptRequest(){this.GetFlag(n)||(this.advanceClock(7),this.setFlag(n,!0),this.statusRegister,this.pushStack(this.programCounter>>8),this.pushStack(this.programCounter),this.pushStack(this.statusRegister),this.programCounter=this.getByte(65534)+(this.getByte(65535)<<8))}nonMaskableInterrupt(){const t=-17&this.statusRegister|32;this.setFlag(n,!0),this.pushStack(this.programCounter>>8),this.pushStack(255&this.programCounter),this.pushStack(t);const s=this.getByte(65530)|this.getByte(65531)<<8;this.programCounter=s}step(){this._currentInstruction_ExtraTiming=0,this.handleNMI?(this.advanceClock(7),this.handleNMI=!1,this.nonMaskableInterrupt()):this.memoryMap.irqRaised()&&this.interruptRequest(),this._currentInstruction_Address=this.programCounter,this._currentInstruction_OpCode=this.getByte(this.programCounter),this.programCounter=this.programCounter+1&65535,this._currentInstruction_AddressingMode=p[this._currentInstruction_OpCode],this.fetchInstructionParameters(),this.execute(),this.advanceClock(u[this._currentInstruction_OpCode]),this.advanceClock(this._currentInstruction_ExtraTiming),this.borrowedCycles&&(this.advanceClock(this.borrowedCycles),this.borrowedCycles=0)}fetchInstructionParameters(){switch(this._currentInstruction_AddressingMode){case i.ChiChiCPPU_AddressingModes.Absolute:case i.ChiChiCPPU_AddressingModes.AbsoluteX:case i.ChiChiCPPU_AddressingModes.AbsoluteY:case i.ChiChiCPPU_AddressingModes.Indirect:this._currentInstruction_Parameters0=this.getByte(65535&this.programCounter++),this._currentInstruction_Parameters1=this.getByte(65535&this.programCounter++);break;case i.ChiChiCPPU_AddressingModes.ZeroPage:case i.ChiChiCPPU_AddressingModes.ZeroPageX:case i.ChiChiCPPU_AddressingModes.ZeroPageY:case i.ChiChiCPPU_AddressingModes.Relative:case i.ChiChiCPPU_AddressingModes.IndexedIndirect:case i.ChiChiCPPU_AddressingModes.IndirectIndexed:case i.ChiChiCPPU_AddressingModes.IndirectZeroPage:case i.ChiChiCPPU_AddressingModes.Immediate:this._currentInstruction_Parameters0=this.getByte(65535&this.programCounter++);break;case i.ChiChiCPPU_AddressingModes.Accumulator:case i.ChiChiCPPU_AddressingModes.Implicit:}}ResetCPU(){this.statusRegister=52,this._operationCounter=0,this.stackPointer=253,this.programCounter=this.getByte(65532)|this.getByte(65533)<<8,this.advanceClock(4),this.genieCodes=[]}PowerOn(){this.statusRegister=52,this.stackPointer=253,this._operationCounter=0,this.advanceClock(4),this.programCounter=this.getByte(65532)|this.getByte(65533)<<8}decodeAddress(){this._currentInstruction_ExtraTiming=0;let t=0,s=0,e=0;switch(this._currentInstruction_AddressingMode){case i.ChiChiCPPU_AddressingModes.Absolute:t=this._currentInstruction_Parameters1<<8|this._currentInstruction_Parameters0;break;case i.ChiChiCPPU_AddressingModes.AbsoluteX:(255&(t=(this._currentInstruction_Parameters1<<8|this._currentInstruction_Parameters0)+this.indexRegisterX|0))<this.indexRegisterX&&(this._currentInstruction_ExtraTiming=1);break;case i.ChiChiCPPU_AddressingModes.AbsoluteY:(255&(t=(this._currentInstruction_Parameters1<<8|this._currentInstruction_Parameters0)+this.indexRegisterY|0))<this.indexRegisterY&&(this._currentInstruction_ExtraTiming=1);break;case i.ChiChiCPPU_AddressingModes.ZeroPage:t=this._currentInstruction_Parameters0;break;case i.ChiChiCPPU_AddressingModes.ZeroPageX:t=255&(this._currentInstruction_Parameters0+this.indexRegisterX|0);break;case i.ChiChiCPPU_AddressingModes.ZeroPageY:t=255&((255&this._currentInstruction_Parameters0)+(255&this.indexRegisterY)|0);break;case i.ChiChiCPPU_AddressingModes.Indirect:s=this._currentInstruction_Parameters0;let a=65535&((e=this._currentInstruction_Parameters1<<8)|s),h=this.getByte(a);a=65535&(e|(s=255&(s+1|0))),t=h|=this.getByte(a)<<8;break;case i.ChiChiCPPU_AddressingModes.IndexedIndirect:var r=255&(this._currentInstruction_Parameters0+this.indexRegisterX|0);s=this.getByte(r),r=r+1|0,e=this.getByte(255&r),t=(e<<=8)|s;break;case i.ChiChiCPPU_AddressingModes.IndirectIndexed:(255&(t=(r=(s=this.getByte(this._currentInstruction_Parameters0))|(e=this.getByte(255&(this._currentInstruction_Parameters0+1|0))<<8))+this.indexRegisterY|0))>this.indexRegisterY&&(this._currentInstruction_ExtraTiming=1);break;case i.ChiChiCPPU_AddressingModes.Relative:t=this.programCounter+this._currentInstruction_Parameters0|0;break;default:this.handleBadOperation()}return 65535&t}handleBadOperation(){}handleBreakpoint(){}decodeOperand(){switch(this._currentInstruction_AddressingMode){case i.ChiChiCPPU_AddressingModes.Immediate:return this.dataBus=this._currentInstruction_Parameters0,this._currentInstruction_Parameters0;case i.ChiChiCPPU_AddressingModes.Accumulator:return this.accumulator;default:return this.dataBus=this.getByte(this.decodeAddress()),this.dataBus}}execute(){let t=0,s=0,e=0,r=0,a=0,u=0;switch(this._currentInstruction_OpCode){case 128:case 130:case 194:case 226:case 4:case 20:case 52:case 68:case 84:case 100:case 116:case 212:case 244:case 12:case 28:case 60:case 92:case 124:case 220:case 252:this.decodeAddress();break;case 105:case 101:case 117:case 109:case 125:case 121:case 97:case 113:t=this.decodeOperand(),r=1&this.statusRegister,a=this.accumulator+t+r|0,this.setFlag(h,a>255),this.setFlag(c,128!=(128&(this.accumulator^t))&&128==(128&(this.accumulator^a))),this.accumulator=255&a,this.setZNFlags(this.accumulator);break;case 41:case 37:case 53:case 45:case 61:case 57:case 33:case 49:this.accumulator=this.accumulator&this.decodeOperand(),this.setZNFlags(this.accumulator);break;case 10:case 6:case 22:case 14:case 30:t=this.decodeOperand(),this.setFlag(h,128==(128&t)),t=t<<1&254,this._currentInstruction_AddressingMode===i.ChiChiCPPU_AddressingModes.Accumulator?this.accumulator=t:this.setByte(this.decodeAddress(),t),this.setZNFlags(t);break;case 144:1!=(1&this.statusRegister)&&this.branch();break;case 176:1==(1&this.statusRegister)&&this.branch();break;case 240:2==(2&this.statusRegister)&&this.branch();break;case 36:case 44:t=this.decodeOperand(),this.setFlag(c,64==(64&t)),this.statusRegister=128==(128&t)?128|this.statusRegister:127&this.statusRegister,0==(t&this.accumulator)?this.statusRegister=2|this.statusRegister:this.statusRegister=253&this.statusRegister;break;case 48:128==(128&this.statusRegister)&&this.branch();break;case 208:2!=(2&this.statusRegister)&&this.branch();break;case 16:128!=(128&this.statusRegister)&&this.branch();break;case 0:this.programCounter=this.programCounter+1,this.pushStack(this.programCounter>>8&255),this.pushStack(255&this.programCounter),t=48|this.statusRegister,this.pushStack(t),this.statusRegister=20|this.statusRegister,this.addressBus=65534,s=this.getByte(this.addressBus),this.addressBus=65535,e=this.getByte(this.addressBus),this.programCounter=s+256*e;break;case 80:64!=(64&this.statusRegister)&&this.branch();break;case 112:64==(64&this.statusRegister)&&this.branch();break;case 24:this.setFlag(h,!1);break;case 216:this.setFlag(o,!1);break;case 88:this.setFlag(n,!1);break;case 184:this.setFlag(c,!1);break;case 201:case 197:case 213:case 205:case 221:case 217:case 193:case 209:t=this.accumulator+256-this.decodeOperand(),this.compare(t);break;case 224:case 228:case 236:t=this.indexRegisterX+256-this.decodeOperand(),this.compare(t);break;case 192:case 196:case 204:t=this.indexRegisterY+256-this.decodeOperand(),this.compare(t);break;case 198:case 214:case 206:case 222:t=(t=this.decodeOperand())-1&255,this.setByte(this.decodeAddress(),t),this.setZNFlags(t);break;case 202:this.indexRegisterX=this.indexRegisterX-1,this.indexRegisterX=255&this.indexRegisterX,this.setZNFlags(this.indexRegisterX);break;case 136:this.indexRegisterY=this.indexRegisterY-1,this.indexRegisterY=255&this.indexRegisterY,this.setZNFlags(this.indexRegisterY);break;case 73:case 69:case 85:case 77:case 93:case 89:case 65:case 81:this.accumulator=this.accumulator^this.decodeOperand(),this.setZNFlags(this.accumulator);break;case 230:case 246:case 238:case 254:t=(t=this.decodeOperand())+1&255,this.setByte(this.decodeAddress(),t),this.setZNFlags(t);break;case 232:this.indexRegisterX=this.indexRegisterX+1,this.indexRegisterX=255&this.indexRegisterX,this.setZNFlags(this.indexRegisterX);break;case 200:this.indexRegisterY=this.indexRegisterY+1,this.indexRegisterY=255&this.indexRegisterY,this.setZNFlags(this.indexRegisterY);break;case 76:case 108:this._currentInstruction_AddressingMode===i.ChiChiCPPU_AddressingModes.Indirect&&255===this._currentInstruction_Parameters0?this.programCounter=255|this._currentInstruction_Parameters1<<8:this.programCounter=this.decodeAddress();break;case 32:this.pushStack(this.programCounter>>8&255),this.pushStack(this.programCounter-1&255),this.programCounter=this.decodeAddress();break;case 169:case 165:case 181:case 173:case 189:case 185:case 161:case 177:this.accumulator=this.decodeOperand(),this.setZNFlags(this.accumulator);break;case 162:case 166:case 182:case 174:case 190:this.indexRegisterX=this.decodeOperand(),this.setZNFlags(this.indexRegisterX);break;case 160:case 164:case 180:case 172:case 188:this.indexRegisterY=this.decodeOperand(),this.setZNFlags(this.indexRegisterY);break;case 74:case 70:case 86:case 78:case 94:t=this.decodeOperand(),this.setFlag(h,1==(1&t)),t=t>>1&255,this.setZNFlags(t),this._currentInstruction_AddressingMode===i.ChiChiCPPU_AddressingModes.Accumulator?this.accumulator=t:this.setByte(this.decodeAddress(),t);break;case 234:case 26:case 58:case 90:case 122:case 218:case 250:case 137:this.decodeAddress();break;case 9:case 5:case 21:case 13:case 29:case 25:case 1:case 17:this.accumulator=this.accumulator|this.decodeOperand(),this.setZNFlags(this.accumulator);break;case 72:this.pushStack(this.accumulator);break;case 8:t=48|this.statusRegister,this.pushStack(t);break;case 104:this.accumulator=this.popStack(),this.setZNFlags(this.accumulator);break;case 40:this.statusRegister=this.popStack();break;case 42:case 38:case 54:case 46:case 62:t=this.decodeOperand(),u=1==(1&this.statusRegister)?1:0,this.setFlag(h,128==(128&t)),t=255&(t<<1|u),this.setZNFlags(t),this._currentInstruction_AddressingMode===i.ChiChiCPPU_AddressingModes.Accumulator?this.accumulator=t:this.setByte(this.decodeAddress(),t);break;case 106:case 102:case 118:case 110:case 126:t=this.decodeOperand(),u=1==(1&this.statusRegister)?128:0,this.setFlag(h,1==(1&t)),t=t>>1|u,this.setZNFlags(t),this._currentInstruction_AddressingMode===i.ChiChiCPPU_AddressingModes.Accumulator?this.accumulator=t:this.setByte(this.decodeAddress(),t);break;case 64:this.statusRegister=this.popStack(),s=this.popStack(),e=this.popStack(),this.programCounter=e<<8|s;break;case 96:s=this.popStack()+1&255,e=this.popStack(),this.programCounter=e<<8|s;break;case 235:case 233:case 229:case 245:case 237:case 253:case 249:case 225:case 241:t=4095&this.decodeOperand(),r=1&(1^this.statusRegister),a=(this.accumulator-t&4095)-r&4095,this.setFlag(c,128==(128&(this.accumulator^a))&&128==(128&(this.accumulator^t))),this.setFlag(h,a<256),this.accumulator=255&a,this.setZNFlags(this.accumulator);break;case 56:this.setFlag(h,!0);break;case 248:this.setFlag(o,!0);break;case 120:this.setFlag(n,!0);break;case 133:case 149:case 141:case 157:case 153:case 129:case 145:this.setByte(this.decodeAddress(),this.accumulator);break;case 134:case 150:case 142:this.setByte(this.decodeAddress(),this.indexRegisterX);break;case 132:case 148:case 140:this.setByte(this.decodeAddress(),this.indexRegisterY);break;case 170:this.indexRegisterX=this.accumulator,this.setZNFlags(this.indexRegisterX);break;case 168:this.indexRegisterY=this.accumulator,this.setZNFlags(this.indexRegisterY);break;case 186:this.indexRegisterX=this.stackPointer,this.setZNFlags(this.indexRegisterX);break;case 138:this.accumulator=this.indexRegisterX,this.setZNFlags(this.accumulator);break;case 154:this.stackPointer=this.indexRegisterX;break;case 152:this.accumulator=this.indexRegisterY,this.setZNFlags(this.accumulator);break;case 11:case 43:this.accumulator=this.decodeOperand()&this.accumulator&255,this.setFlag(h,128==(128&this.accumulator)),this.setZNFlags(this.accumulator);break;case 75:this.accumulator=this.decodeOperand()&this.accumulator,this.setFlag(h,1==(1&this.accumulator)),this.accumulator=this.accumulator>>1,this.setZNFlags(this.accumulator);break;case 107:switch(this.accumulator=this.decodeOperand()&this.accumulator,1==(1&this.statusRegister)?this.accumulator=this.accumulator>>1|128:this.accumulator=this.accumulator>>1,this.setFlag(h,1==(1&this.accumulator)),48&this.accumulator){case 48:this.setFlag(h,!0),this.setFlag(n,!1);break;case 0:this.setFlag(h,!1),this.setFlag(n,!1);break;case 16:this.setFlag(h,!1),this.setFlag(n,!0);break;case 32:this.setFlag(h,!0),this.setFlag(n,!0)}break;case 171:this.indexRegisterX=this.accumulator=this.decodeOperand()&this.accumulator,this.setZNFlags(this.indexRegisterX)}}setZNFlags(t){0==(255&t)?this.statusRegister|=2:this.statusRegister&=-3,128==(128&t)?this.statusRegister|=128:this.statusRegister&=-129}compare(t){this.setFlag(h,t>255),this.setZNFlags(255&t)}branch(){const t=this.programCounter>>8&255;this._currentInstruction_ExtraTiming=1;let s=255&this._currentInstruction_Parameters0;128==(128&s)&&(s-=256),this.programCounter+=s,this.programCounter&=65535,t!=(this.programCounter>>8&255)&&(this._currentInstruction_ExtraTiming=2)}nmiHandler(){this.handleNMI=!0}pushStack(t){this.memoryMap.Rams[this.stackPointer+256]=t,this.stackPointer--,this.stackPointer<0&&(this.stackPointer=255)}popStack(){return this.stackPointer++,this.stackPointer>255&&(this.stackPointer=0),this.memoryMap.Rams[this.stackPointer+256]}getByte(t){if(!this.memoryMap)return 0;let s=this.memoryMap.getByte(this.clock,t);if(this.cheating){const e=this.genieCodes.find(s=>s.address==t);if(e&&e.active&&e.address==t)return e.compare>-1?255&(e.compare==s?e.data:s):e.data}return 255&s}setByte(t,s){this.memoryMap&&this.memoryMap.setByte(this.clock,t,s)}HandleNextEvent(){}ResetInstructionHistory(){this.instructionHistoryPointer=255}},s.stateConfig=(t=>s=>({configure:()=>{s.pushSegment(2*Uint16Array.BYTES_PER_ELEMENT,"cpu_status_16").pushSegment(8,"cpu_status")},push:()=>d(t),pull:()=>l(t,s)}))},function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const i=e(16);s.bufferType="ArrayBuffer";class r{constructor(){this.data={buffer:void 0,segments:new Array},this.bufferSize=0,this.onRestore=new i.Subject,this.onUpdateBuffer=new i.Subject}pushArray(t,s){return this.pushSegment(t.length*t.BYTES_PER_ELEMENT,s),this}pushSegment(t,s){if(-1===this.data.segments.findIndex((t,e)=>t.name==s)){const e=this.bufferSize;this.data.segments.push({name:s,start:e,size:t}),this.bufferSize+=t}return this}build(){return this.data.buffer=new ArrayBuffer(this.bufferSize),this.onRestore.next(this),this}updateBuffer(){this.onUpdateBuffer.next(this)}getSegment(t){const s=this.data.segments.find(s=>s.name===t);return{buffer:this.data.buffer,start:s.start,size:s.size}}getUint8Array(t){const s=this.data.segments.find(s=>s.name===t);return new Uint8Array(this.data.buffer,s.start,s.size)}getUint16Array(t){const s=this.data.segments.find(s=>s.name===t);return new Uint16Array(this.data.buffer,s.start,s.size/Uint16Array.BYTES_PER_ELEMENT)}getUint32Array(t){const s=this.data.segments.find(s=>s.name===t);return new Uint32Array(this.data.buffer,s.start,s.size/Uint32Array.BYTES_PER_ELEMENT)}getFloat32Array(t){const s=this.data.segments.find(s=>s.name===t);return new Float32Array(this.data.buffer,s.start,s.size/Float32Array.BYTES_PER_ELEMENT)}syncBuffer(t){this.data=t,this.onRestore.next(this)}clone(){const t=new r;return t.syncBuffer({segments:Array.from(this.data.segments),buffer:this.data.buffer.slice(0)}),t.bufferSize=this.bufferSize,t}}s.StateBuffer=r},function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});s.ChiChiControlPad=class{constructor(){this.currentByte=0,this.readNumber=0,this.getPadState=(()=>0),this.getByte=((t,s)=>{var e=this.currentByte>>this.readNumber&1;return this.readNumber=this.readNumber+1&7,255&(64|e)}),this.setByte=((t,s,e)=>{1==(1&e)&&(this.currentByte=this.getPadState(),16==(16&this.currentByte)&&(this.currentByte=-33&this.currentByte),64==(64&this.currentByte)&&(this.currentByte=-129&this.currentByte),this.readNumber=0)})}}},function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const i=e(0);class r extends i.BaseCart{constructor(){super(...arguments),this.irqLatch=0,this.prescaler=341,this.irqCounter=0,this.irqMode=!1,this.irqEnableAfterAck=!1,this.irqEnable=!1}tickIrq(){this.irqCounter>=255?(this.irqCounter=this.irqLatch,this.irqRaised=!0):this.irqCounter++}tick(t){if(this.irqMode)for(let s=0;s<t;++s)this.tickIrq();else this.prescaler-=3*t,this.prescaler<=0&&(this.tickIrq(),this.prescaler+=341)}advanceClock(t){this.irqEnable&&this.tick(t)}ackIrq(){this.irqRaised=!1,this.irqEnable=this.irqEnableAfterAck}set irqControl(t){this.irqEnableAfterAck=1==(1&t);let s=2==(2&t);this.irqMode=4==(4&t),this.irqEnable=s}}s.VRCIrqBase=r;class a extends r{constructor(){super(...arguments),this.microwire=!1,this.vrc2=!1,this.swapMode=!1,this.microwireLatch=0,this.latches=[0,0,0,0,0,0,0,0],this.regNums=[0,1,2,3],this.regMask=15,this.ramMask=4095,this.vrc2mirroring=((t,s,e)=>{if(s<=36867)switch(1&e){case 0:this.mirror(t,1);break;case 1:this.mirror(t,2)}}),this.vrc4mirroring=((t,s,e)=>{if(s<=36865)switch(7&e){case 0:this.mirror(t,1);break;case 1:this.mirror(t,2);break;case 2:this.oneScreenOffset=0,this.mirror(t,0);break;case 3:this.oneScreenOffset=1024,this.mirror(t,0)}36866!=s&&36867!=s||(this.swapMode=2==(2&e))}),this.vrcmirroring=this.vrc4mirroring}useMicrowire(){this.getByte=this.getByteMicrowire,this.microwire=!0}getByteMicrowire(t,s){return s>=24576&&s<=32767?s>>8|this.microwireLatch:this.peekByte(s)}setByteVRC4(t,s,e){switch(61440&s){case 24576:this.prgRomBank6[e&this.ramMask]=e;break;case 28672:break;case 32768:let i=31&e;this.swapMode?this.setupBankStarts(2*this.prgRomCount-2,this.currentA,i,this.currentE):this.setupBankStarts(i,this.currentA,2*this.prgRomCount-2,this.currentE);break;case 36864:this.vrc4mirroring(t,s,e);break;case 40960:let r=31&e;this.setupBankStarts(this.current8,r,this.currentC,this.currentE);break;case 45056:case 49152:case 53248:case 57344:const a=s&this.regMask,h=(s>>12&15)-11<<1;a==this.regNums[0]?(this.latches[h]=496&this.latches[h]|15&e,this.copyBanks1k(t,h,this.latches[h],1)):a==this.regNums[1]?(this.latches[h]=15&this.latches[h]|e<<4&496,this.copyBanks1k(t,h,this.latches[h],1)):a==this.regNums[2]?(this.latches[h+1]=496&this.latches[h+1]|15&e,this.copyBanks1k(t,h+1,this.latches[h+1],1)):a==this.regNums[3]&&(this.latches[h+1]=15&this.latches[h+1]|e<<4&496,this.copyBanks1k(t,h+1,this.latches[h+1],1));break;case 61440:switch(3&s){case 0:this.irqLatch=240&this.irqLatch|15&e;break;case 1:this.irqLatch=15&this.irqLatch|e<<4&240;break;case 2:this.irqControl=e;break;case 3:this.ackIrq()}}}setByteVRC2(t,s,e){switch(61440&s){case 24576:case 28672:this.microwireLatch=1&e;break;case 32768:let i=31&e;this.swapMode?this.setupBankStarts(2*this.prgRomCount-2,this.currentA,i,this.currentE):this.setupBankStarts(i,this.currentA,2*this.prgRomCount-2,this.currentE);break;case 36864:this.vrc2mirroring(t,s,e);break;case 40960:let r=31&e;this.setupBankStarts(this.current8,r,this.currentC,this.currentE);break;case 45056:case 49152:case 53248:case 57344:const a=s&this.regMask,h=(s>>12&15)-11<<1;a==this.regNums[0]?(this.latches[h]=240&this.latches[h]|15&e,this.copyBanks1k(t,h,this.latches[h],1)):a==this.regNums[1]?(this.latches[h]=15&this.latches[h]|e<<4&240,this.copyBanks1k(t,h,this.latches[h],1)):a==this.regNums[2]?(this.latches[h+1]=240&this.latches[h+1]|15&e,this.copyBanks1k(t,h+1,this.latches[h+1],1)):a==this.regNums[3]&&(this.latches[h+1]=15&this.latches[h+1]|e<<4&240,this.copyBanks1k(t,h+1,this.latches[h+1],1));break;case 61440:0==(3&s)?this.irqLatch=240&this.irqLatch|15&e:1==(3&s)?this.irqLatch=15&this.irqLatch|e<<4&240:2==(3&s)?this.irqControl=e:3==(3&s)&&this.ackIrq()}}setByteVRC2a(t,s,e){switch(61440&s){case 24576:case 28672:this.microwire?this.microwireLatch=1&e:this.prgRomBank6[e&this.ramMask]=e;break;case 32768:let i=31&e;this.swapMode?this.setupBankStarts(2*this.prgRomCount-2,this.currentA,i,this.currentE):this.setupBankStarts(i,this.currentA,2*this.prgRomCount-2,this.currentE);break;case 36864:this.vrc2mirroring(t,s,e);break;case 40960:let r=31&e;this.setupBankStarts(this.current8,r,this.currentC,this.currentE);break;case 45056:case 49152:case 53248:case 57344:const a=s&this.regMask,h=(s>>12&15)-11<<1;a==this.regNums[0]?(this.latches[h]=240&this.latches[h]|15&e,this.copyBanks1k(t,h,this.latches[h]>>1,1)):a==this.regNums[1]?(this.latches[h]=15&this.latches[h]|e<<4&240,this.copyBanks1k(t,h,this.latches[h]>>1,1)):a==this.regNums[2]?(this.latches[h+1]=240&this.latches[h+1]|15&e,this.copyBanks1k(t,h+1,this.latches[h+1]>>1,1)):a==this.regNums[3]&&(this.latches[h+1]=15&this.latches[h+1]|e<<4&240,this.copyBanks1k(t,h+1,this.latches[h+1]>>1,1));break;case 61440:0==(3&s)?this.irqLatch=240&this.irqLatch|15&e:1==(3&s)?this.irqLatch=15&this.irqLatch|e<<4&240:2==(3&s)?this.irqControl=e:3==(3&s)&&this.ackIrq()}}}s.VRC2or4Cart=a;s.KonamiVRC2Cart=class extends a{altRegNums(){this.regNums=[0,4,8,12],this.regMask=15}initializeCart(){switch(this.mapperName="KonamiVRC24",this.usesSRAM=!0,this.ramMask=4095,this.setupBankStarts(0,0,2*this.prgRomCount-2,2*this.prgRomCount-1),this.copyBanks4k(0,0,0,2),this.setByte=this.setByteVRC4,this.ROMHashFunction){case"CC9FFEC":case"B27B8CF4":this.setByte=this.setByteVRC2,this.useMicrowire();break;case"D467C0CC":case"C1FBF659":case"91328C1D":case"FCBF28B1":this.altRegNums()}}};s.KonamiVRC022Cart=class extends a{initializeCart(){switch(this.mapperName="KonamiVRC2a",this.setupBankStarts(0,0,2*this.prgRomCount-2,2*this.prgRomCount-1),this.copyBanks4k(0,0,0,2),this.regNums=[0,2,1,3],this.vrcmirroring=this.vrc2mirroring,this.useMicrowire(),this.setByte=this.setByteVRC2a,this.ROMHashFunction){case"D4645E14":this.vrcmirroring=this.vrc4mirroring}}};s.Konami021Cart=class extends a{initializeCart(){switch(this.mapperName="KonamiVRC2",this.setupBankStarts(0,0,2*this.prgRomCount-2,2*this.prgRomCount-1),this.copyBanks4k(0,0,0,2),this.regNums=[0,2,4,6],this.regMask=240,this.ROMHashFunction){case"286FCD20":this.regNums=[0,64,128,192],this.regMask=240,this.ramMask=8191}this.setByte=this.setByteVRC2}};s.Konami025Cart=class extends a{initializeCart(){switch(this.usesSRAM=!0,this.mapperName="KonamiVRC4",this.setupBankStarts(0,0,2*this.prgRomCount-2,2*this.prgRomCount-1),this.regNums=[0,2,1,3],this.regMask=15,this.ROMHashFunction){case"4A601A2C":this.regNums=[0,8,4,12]}this.setByte=this.setByteVRC4}}},function(t,s,e){"use strict";(function(t){Object.defineProperty(s,"__esModule",{value:!0});const i=e(46);s.decodeFile=(s=>{if(!s||s.byteLength<16)throw new Error("invalid NES file");const e=new Uint8Array(s,16),r=new Uint8Array(s,6,3),a=new Uint8Array(s,4,2),h=new Uint8Array(s,10,2),n=a[0],o=16384*n,c=a[1],u=8192*c,p=8==(8&r[0])?3:1==(1&r[0])?1:2,l=function(){const t=r;let s=240&t[0];return s>>=4,s|=240&t[1],s|=(15&t[2])<<8}();return{magicNumber:new Uint8Array(s,0,3),romCountArray:a,mapperBytes:r,ramCountArray:h,prgRom:new Uint8Array(s,16,o),chrRom:new Uint8Array(s,16+o,u),mapperId:l,submapperId:r[2]>>4,prgRomCount:n,prgRomLength:o,chrRomCount:c,chrRomLength:u,prgRamBanks:15&h[0],prgRamBanksBatteryBacked:h[0]>>4&15,chrRamBanks:15&h[1],chrRamBanksBatteryBacked:h[1]>>4&15,isPC10:2==(2&r[1]),isVS:1==(1&r[1]),usesSRAM:2==(2&r[0]),batterySRAM:2==(2&r[0]),mirroring:p,fourScreen:8==(8&r[0]),romCRC:i.crc32(new t(e)).toString(16).toUpperCase()}})}).call(s,e(41).Buffer)},function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var i=e(11);s.ChiChiMachine=i.ChiChiMachine;var r=e(5);s.ChiChiCPPU=r.ChiChiCPPU;var a=e(2);s.ChiChiAPU=a.ChiChiAPU;var h=e(3);s.PixelBuffers=h.PixelBuffers,s.ChiChiPPU=h.ChiChiPPU;var n=e(0);s.BaseCart=n.BaseCart;var o=e(4);s.WavSharer=o.WavSharer;var c=e(1);s.RunningStatuses=c.RunningStatuses,s.DebugStepTypes=c.DebugStepTypes,s.ChiChiCPPU_AddressingModes=c.ChiChiCPPU_AddressingModes,s.CpuStatus=c.CpuStatus,s.PpuStatus=c.PpuStatus,s.ChiChiInstruction=c.ChiChiInstruction,s.ChiChiSprite=c.ChiChiSprite;var u=e(18);s.ChiChiCheats=u.ChiChiCheats;var p=e(19);s.DebugHelpers=p.DebugHelpers;var l=e(6);s.StateBuffer=l.StateBuffer;var d=e(20);s.iNESFileHandler=d.iNESFileHandler;var m=e(7);s.ChiChiControlPad=m.ChiChiControlPad;const g=e(9);s.NESFileDecoder=g},function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const i=e(2),r=e(1),a=e(3),h=e(4),n=e(5),o=e(6),c=e(17),u=e(7);s.ChiChiMachine=class{constructor(t){this.frameJustEnded=!0,this.frameOn=!1,this.totalCPUClocks=0,this._enableSound=!1,this.evenFrame=!0,this.stateBuffer=new o.StateBuffer;const s=new h.ChiChiWavSharer(this.stateBuffer);this.SoundBopper=new i.ChiChiAPU(s),this.WaveForms=s,this.ppu=new a.ChiChiPPU,this.Cpu=t||new n.ChiChiCPPU(this.SoundBopper,this.ppu),this.ppu.cpu=this.Cpu,this.ppu.NMIHandler=(()=>{this.Cpu.nmiHandler()}),this.ppu.frameFinished=(()=>{this.frameFinished()}),this.controllerPortOne=new u.ChiChiControlPad,this.controllerPortTwo=new u.ChiChiControlPad,this.mapFactory=c.setupMemoryMap(this.Cpu)(this.ppu)(this.SoundBopper)(this.controllerPortOne)(this.controllerPortTwo)}loadCart(t){const s=this.mapFactory(t);this.stateBuffer=p(s),t.installCart(this.ppu,this.Cpu)}Drawscreen(){}get Cart(){return this.Cpu&&this.Cpu.memoryMap&&this.Cpu.memoryMap.cart?this.Cpu.memoryMap.cart:void 0}get EnableSound(){return this._enableSound}set EnableSound(t){this._enableSound=t,this._enableSound&&this.SoundBopper.rebuildSound()}Reset(){this.Cpu&&this.Cart&&this.Cart.supported&&(this.Cart.initializeCart(!0),this.Cpu.ResetCPU(),this.SoundBopper.rebuildSound(),this.RunState=r.RunningStatuses.Running)}PowerOn(){this.Cpu&&this.Cart&&this.Cart.supported&&(this.Cart.initializeCart(),this.Cpu.ppu.initialize(),this.SoundBopper.rebuildSound(),this.Cpu.PowerOn(),this.RunState=r.RunningStatuses.Running)}PowerOff(){this.RunState=r.RunningStatuses.Off}Step(){this.frameJustEnded&&(this.frameOn=!0,this.frameJustEnded=!1),this.Cpu.step(),this.frameOn||(this.totalCPUClocks=0,this.Cpu.Clock=0,this.ppu.LastcpuClock=0,this.frameJustEnded=!0)}RunFrame(){this.frameOn=!0,this.frameJustEnded=!1;do{this.Cpu.step()}while(this.frameOn);this.totalCPUClocks=0,this.Cpu.Clock=0,this.ppu.LastcpuClock=0}EjectCart(){this.Cpu.memoryMap=null}LoadNSF(t){}frameFinished(){this.frameJustEnded=!0,this.frameOn=!1,this.Drawscreen()}dispose(){}};const p=t=>{const s=new o.StateBuffer;return t.setupStateBuffer(s),t.cpu.setupStateBuffer(s),t.ppu.setupStateBuffer(s),t.cart.setupStateBuffer(s),s.build(),s}},function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});s.DMCChannel=class{constructor(t,s,e){this.onWriteAudio=s,this.handleDma=e,this.playing=!0,this.output=0,this.interruptRaised=!1,this.time=0,this.internalClock=0,this.isFetching=!1,this.buffer=0,this.bufferIsEmpty=!1,this.outbits=0,this.freqTable=[428,380,340,320,286,254,226,214,190,160,142,128,106,84,72,54],this.shiftreg=0,this.silenced=!1,this.cycles=0,this.nextRead=0,this.lengthCounter=0,this.length=0,this.address=0,this.interruptEnabled=0,this.frequency=0,this.loopFlag=0,this._chan=0,this._chan=t}writeRegister(t,s,e){switch(t){case 0:this.frequency=15&s,this.loopFlag=s>>6&1,this.interruptEnabled=s>>7&1,0===this.interruptEnabled&&(this.interruptRaised=!1);break;case 1:this.output=127&s,this.onWriteAudio(this.time);break;case 2:this.address=s;break;case 3:this.length=s;break;case 4:this.interruptRaised=!1,s?this.lengthCounter||(this.nextRead=49152|this.address<<6&65535,this.lengthCounter=1+(this.length<<4)):this.lengthCounter=0}}run(t){if(!this.playing)return this.time=t,void(this.output=0);for(;this.time<t;this.time++)--this.cycles<=0&&(this.cycles=this.freqTable[this.frequency],this.silenced||(1&this.shiftreg?this.output<=125&&(this.output+=2,this.onWriteAudio(this.time)):this.output>=2&&(this.output-=2,this.onWriteAudio(this.time)),this.shiftreg>>=1),--this.outbits<=0&&(this.outbits=8,this.bufferIsEmpty?this.silenced=!0:(this.shiftreg=this.buffer,this.bufferIsEmpty=!0,this.silenced=!1))),this.bufferIsEmpty&&!this.isFetching&&this.lengthCounter&&(this.isFetching=!0,this.fetch(),this.lengthCounter--)}fetch(){this.buffer=this.handleDma(this.nextRead),this.bufferIsEmpty=!1,this.isFetching=!1,65536==++this.nextRead&&(this.nextRead=32768),this.lengthCounter||(this.loopFlag?(this.nextRead=49152|this.address<<6&65535,this.lengthCounter=1+(this.length<<4)):this.interruptEnabled&&(this.interruptRaised=!0))}endFrame(t){this.run(t),this.time=0}}},function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});s.SquareChannel=class{constructor(t,s){this.onWriteAudio=s,this.output=0,this.playing=!0,this.channelNumber=0,this.lengthCounts=new Uint8Array([10,254,20,2,40,4,80,6,160,8,60,10,14,12,26,14,12,16,24,18,48,20,96,22,192,24,72,26,16,28,32,30]),this.latchedLength=0,this.period=0,this.rawTimer=0,this.volume=0,this.time=0,this.envelope=0,this.looping=!1,this.enabled=!1,this.doodies=[2,6,30,249],this.sweepShift=0,this.sweepCounter=0,this.sweepDivider=0,this.sweepNegateFlag=!1,this.sweepEnabled=!1,this.startSweep=!1,this.sweepInvalid=!1,this.phase=0,this.envelopeTimer=0,this.envelopeStart=!1,this.envelopeConstantVolume=!1,this.envelopeVolume=0,this.sweepComplement=!1,this.dutyCycle=0,this.channelNumber=t,this.enabled=!0,this.sweepDivider=1,this.envelopeTimer=15}writeRegister(t,s,e){switch(t){case 0:this.envelopeConstantVolume=16==(16&s),this.volume=15&s,this.dutyCycle=this.doodies[s>>6&3],this.looping=32==(32&s),this.sweepInvalid=!1;break;case 1:this.sweepShift=7&s,this.sweepNegateFlag=8==(8&s),this.sweepDivider=s>>4&7,this.sweepEnabled=128==(128&s),this.startSweep=!0,this.sweepInvalid=!1;break;case 2:this.period&=1792,this.period|=s,this.rawTimer=this.period;break;case 3:this.period&=255,this.period|=(7&s)<<8,this.rawTimer=this.period,this.phase=0,this.enabled&&(this.latchedLength=this.lengthCounts[s>>3&31]),this.envelopeStart=!0;break;case 4:this.enabled=0!==s,this.enabled||(this.latchedLength=0)}}run(t){if(!this.playing)return this.time=t,void(this.output=0);const s=this.sweepEnabled?(this.period+1&2047)<<1:(this.rawTimer+1&2047)<<1;if(0===s)return this.time=t,this.output=0,void this.onWriteAudio(this.time);const e=this.envelopeConstantVolume?this.volume:this.envelopeVolume;if(0===this.latchedLength||0===e||this.sweepInvalid)return this.phase+=(t-this.time)/s&7,this.output=0,void this.onWriteAudio(this.time);for(;this.time<t;this.time+=s,this.phase++)this.output=(this.dutyCycle>>(7&this.phase)&1)*e,this.onWriteAudio(this.time);this.phase&=7}endFrame(t){this.run(t),this.time=0}frameClock(t,s){switch(this.run(t),this.envelopeStart?(this.envelopeStart=!1,this.envelopeTimer=this.volume+1,this.envelopeVolume=15):(this.envelopeTimer--,0===this.envelopeTimer&&(this.envelopeTimer=this.volume+1,this.envelopeVolume>0?this.envelopeVolume--:this.envelopeVolume=this.looping?15:0)),s){case 1:case 3:if(--this.sweepCounter,0===this.sweepCounter&&(this.sweepCounter=this.sweepDivider+1,this.sweepEnabled&&this.sweepShift>0)){var e=this.period>>this.sweepShift;this.sweepComplement?this.period+=this.sweepNegateFlag?~e:e:this.period+=this.sweepNegateFlag?1+~e:e,this.sweepInvalid=this.rawTimer<8||2048==(2048&this.period)}this.startSweep&&(this.startSweep=!1,this.sweepCounter=this.sweepDivider+1),!this.looping&&this.latchedLength>0&&this.latchedLength--}}}},function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});s.TriangleChannel=class{constructor(t,s){this.onWriteAudio=s,this.playing=!0,this.output=0,this._chan=0,this.lengthCounts=[10,254,20,2,40,4,80,6,160,8,60,10,14,12,26,14,12,16,24,18,48,20,96,22,192,24,72,26,16,28,32,30],this.length=0,this.period=0,this.time=0,this.envelope=0,this.looping=!1,this.enabled=!1,this.linCtr=0,this._phase=0,this._linVal=0,this.linStart=!1,this._chan=t,this.enabled=!0}writeRegister(t,s,e){switch(t){case 0:this.looping=128==(128&s),this._linVal=127&s;break;case 1:break;case 2:this.period&=1792,this.period|=s;break;case 3:this.period&=255,this.period|=(7&s)<<8,this.enabled&&(this.length=this.lengthCounts[s>>3&31]),this.linStart=!0;break;case 4:this.enabled=0!==s,this.enabled||(this.length=0)}}run(t){if(!this.playing)return this.time=t,void(this.output=0);var s=this.period+1;if(0===this.linCtr||0===this.length||this.period<4)this.time=t;else for(;this.time<t;this.time+=s,this._phase=(this._phase+1)%32)this.output=this._phase<16?this._phase:31-this._phase,this.onWriteAudio(this.time)}endFrame(t){this.run(t),this.time=0}frameClock(t,s){switch(this.run(t),this.linStart?this.linCtr=this._linVal:this.linCtr>0&&this.linCtr--,this.looping||(this.linStart=!1),s){case 1:case 3:this.length>0&&!this.looping&&this.length--}}}},function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});s.NoiseChannel=class{constructor(t,s){this.onWriteAudio=s,this.playing=!0,this.output=0,this.period=0,this.enabled=!1,this.chan=0,this.noisePeriods=[4,8,16,32,64,96,128,160,202,254,380,508,762,1016,2034,4068],this.lengthCounts=[10,254,20,2,40,4,80,6,160,8,60,10,14,12,26,14,12,16,24,18,48,20,96,22,192,24,72,26,16,28,32,30],this.time=0,this.envConstantVolume=!1,this.envVolume=0,this.phase=0,this.envTimer=0,this.envStart=!1,this.length=0,this.volume=0,this.looping=!1,this.chan=t,this.phase=1,this.envTimer=15}writeRegister(t,s,e){switch(t){case 0:this.envConstantVolume=16==(16&s),this.volume=15&s,this.looping=128==(128&s);break;case 1:break;case 2:this.period=this.noisePeriods[15&s];break;case 3:this.enabled&&(this.length=this.lengthCounts[s>>3&31]),this.envStart=!0;break;case 4:this.enabled=0!==s,this.enabled||(this.length=0)}}run(t){if(!this.playing)return this.time=t,void(this.output=0);let s=this.envConstantVolume?this.volume:this.envVolume;if(0===this.length&&(s=0),0===this.period)return this.time=t,this.output=0,void this.onWriteAudio(this.time);for(0===this.phase&&(this.phase=1);this.time<t;this.time+=this.period){let t=this.looping?1&this.phase^this.phase>>6&1:1&this.phase^this.phase>>1&1;this.output=this.phase&1*s,this.onWriteAudio(this.time),this.phase=65535&(this.phase>>1|t<<14)}}endFrame(t){this.run(t),this.time=0}frameClock(t,s){switch(this.run(t),this.envStart?(this.envStart=!1,this.envTimer=this.volume+1,this.envVolume=15):(this.envTimer--,0===this.envTimer&&(this.envTimer=this.volume+1,this.envVolume>0?this.envVolume--:this.envVolume=this.looping?15:0)),s){case 1:case 2:!this.looping&&this.length>0&&this.length--}}}},function(s,e){s.exports=t},function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const i=t=>t=>s=>e=>i=>r=>a=>(h,n)=>{let o=0;switch(61440&n){case 0:case 4096:o=n<2048?e[n]:n>>8;break;case 8192:case 12288:o=t.getByte(h,n);break;case 16384:switch(n){case 16405:o=s.GetByte(h,n);break;case 16406:o=i.getByte(h,n);break;case 16407:o=r.getByte(h,n);break;default:o=a.mapsBelow6000?a.getByte(h,n):n>>8}break;case 20480:o=n>>8;break;case 24576:case 28672:case 32768:case 36864:case 40960:case 45056:case 49152:case 53248:case 57344:case 61440:o=a.getByte(h,n);break;default:throw new Error("Bullshit!")}return 255&o},r=t=>s=>e=>i=>r=>a=>h=>(n,o,c)=>{if(o<2048)i[2047&o]=c;else switch(61440&o){case 0:case 4096:i[2047&o]=c;break;case 20480:h.setByte(n,o,c);break;case 24576:case 28672:case 32768:case 36864:case 40960:case 45056:case 49152:case 53248:case 57344:case 61440:h.setByte(n,o,c);break;case 8192:case 12288:s.setByte(n,o,c);break;case 16384:switch(o){case 16384:case 16385:case 16386:case 16387:case 16388:case 16389:case 16390:case 16391:case 16392:case 16393:case 16394:case 16395:case 16396:case 16397:case 16398:case 16399:case 16400:case 16401:case 16402:case 16403:case 16405:case 16407:e.SetByte(n,o,c);break;case 16404:s.copySprites(256*c),t._currentInstruction_ExtraTiming=t._currentInstruction_ExtraTiming+513,1&n&&t._currentInstruction_ExtraTiming++;break;case 16406:r.setByte(n,o,1&c|64),a.setByte(n,o,1&c|64);break;default:h.mapsBelow6000&&h.setByte(n,o,c)}}};s.setupMemoryMap=(t=>s=>e=>a=>h=>{let n=new Uint8Array(new ArrayBuffer(8192*Uint8Array.BYTES_PER_ELEMENT));const o=[s,e],c=t=>(t.onRestore.subscribe(t=>{n=t.getUint8Array("rams")}),t.pushSegment(8192*Uint8Array.BYTES_PER_ELEMENT,"rams"),t);return u=>{o.push(u);const p={getByte:i()(s)(e)(n)(a)(h),setByte:r(t)(s)(e)(n)(a)(h)},l={ppu:s,apu:e,pad1:a,pad2:h,cpu:t,Rams:n,cart:u,setupStateBuffer:c,getByte:p.getByte(u),setByte:p.setByte(u),getPPUByte:(t,s)=>u.getPPUByte(t,s),setPPUByte:(t,s,e)=>u.setPPUByte(t,s,e),irqRaised:()=>u.irqRaised||e.interruptRaised,advanceClock:t=>o.forEach(s=>s.advanceClock(t)),advanceScanline:t=>{for(;t-- >=0;)u.updateScanlineCounter()}};return t.memoryMap=e.memoryMap=s.memoryMap=l,l}})},function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const i=["A","P","Z","L","G","I","T","Y","E","O","X","U","K","S","V","N"];s.ChiChiCheats={gameGenieCodeToPatch:function(t){let s=null;const e=t.split("").map(t=>i.findIndex(s=>s===t)),r=32768+((7&e[3])<<12)|(7&e[5])<<8|(8&e[4])<<8|(7&e[2])<<4|(8&e[1])<<4|7&e[4]|8&e[3];let a=0,h=0;return 6==e.length?s={address:r,data:a=(7&e[1])<<4|(8&e[0])<<4|7&e[0]|8&e[5],compare:h,active:!0}:8==e.length&&(s={address:r,data:a=(7&e[1])<<4|(8&e[0])<<4|7&e[0]|8&e[7],compare:h=(7&e[7])<<4|(8&e[6])<<4|7&e[6]|8&e[5],active:!0}),s}}},function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const i=e(1);s.DebugHelpers=class{static disassemble(t){if(!t||!t.OpCode)return"";let s="",e=0;s+=t.Parameters0.toString(16),s+=t.Parameters1.toString(16);let r=t.Address.toString(16)+": ";switch(t.AddressingMode){case i.ChiChiCPPU_AddressingModes.Accumulator:case i.ChiChiCPPU_AddressingModes.Implicit:r+=this.getMnemnonic(t.OpCode);break;case i.ChiChiCPPU_AddressingModes.Immediate:r+=this.getMnemnonic(t.OpCode)+" #"+t.Parameters0.toString(16);break;case i.ChiChiCPPU_AddressingModes.ZeroPage:r+=this.getMnemnonic(t.OpCode)+" "+t.Parameters0.toString(16);break;case i.ChiChiCPPU_AddressingModes.ZeroPageX:r+=this.getMnemnonic(t.OpCode)+" "+t.Parameters0.toString(16)+", "+t.X.toString(16);break;case i.ChiChiCPPU_AddressingModes.ZeroPageY:r+=this.getMnemnonic(t.OpCode)+" "+t.Parameters0.toString(16)+", "+t.Y.toString(16);break;case i.ChiChiCPPU_AddressingModes.Relative:128==(128&t.Parameters0)?r+=this.getMnemnonic(t.OpCode)+" *"+t.Parameters0.toString(16):r+=this.getMnemnonic(t.OpCode)+" *+"+t.Parameters0.toString(16);break;case i.ChiChiCPPU_AddressingModes.Absolute:e=256*t.Parameters1|t.Parameters0,r+=this.getMnemnonic(t.OpCode)+" "+e.toString(16);break;case i.ChiChiCPPU_AddressingModes.AbsoluteX:e=256*t.Parameters1|t.Parameters0,r+=this.getMnemnonic(t.OpCode)+" "+e.toString(16)+","+t.X.toString(16);break;case i.ChiChiCPPU_AddressingModes.AbsoluteY:e=256*t.Parameters1|t.Parameters0,r+=this.getMnemnonic(t.OpCode)+" "+e.toString(16)+","+t.Y.toString(16);break;case i.ChiChiCPPU_AddressingModes.Indirect:e=256*t.Parameters1|t.Parameters0,r+=this.getMnemnonic(t.OpCode)+" ("+e.toString(16)+")";break;case i.ChiChiCPPU_AddressingModes.IndexedIndirect:r+=this.getMnemnonic(t.OpCode)+" ("+t.Parameters0.toString(16)+", "+t.X.toString(16);break;case i.ChiChiCPPU_AddressingModes.IndirectIndexed:r+=this.getMnemnonic(t.OpCode)+" ("+t.Parameters0.toString(16)+", "+t.Y.toString(16)}return r}static getMnemnonic(t){switch(t){case 128:case 130:case 194:case 226:case 4:case 20:case 52:case 68:case 84:case 100:case 116:case 212:case 244:case 12:case 28:case 60:case 92:case 124:case 220:case 252:return"DOP";case 105:case 101:case 117:case 109:case 125:case 121:case 97:case 113:return"ADC";case 41:case 37:case 53:case 45:case 61:case 57:case 33:case 49:return"AND";case 10:case 6:case 22:case 14:case 30:return"ASL";case 144:return"BCC";case 176:return"BCS";case 240:return"BEQ";case 36:case 44:return"BIT";case 48:return"BMI";case 208:return"BNE";case 16:return"BPL";case 0:return"BRK";case 80:return"BVC";case 112:return"BVS";case 24:return"CLC";case 216:return"CLD";case 88:return"CLI";case 184:return"CLV";case 201:case 197:case 213:case 205:case 221:case 217:case 193:case 209:return"CMP";case 224:case 228:case 236:return"CPX";case 192:case 196:case 204:return"CPY";case 198:case 214:case 206:case 222:return"DEC";case 202:return"DEX";case 136:return"DEY";case 73:case 69:case 85:case 77:case 93:case 89:case 65:case 81:return"EOR";case 230:case 246:case 238:case 254:return"INC";case 232:return"INX";case 200:return"INY";case 76:case 108:return"JMP";case 32:return"JSR";case 169:case 165:case 181:case 173:case 189:case 185:case 161:case 177:return"LDA";case 162:case 166:case 182:case 174:case 190:return"LDX";case 160:case 164:case 180:case 172:case 188:return"LDY";case 74:case 70:case 86:case 78:case 94:return"LSR";case 234:case 26:case 58:case 90:case 122:case 218:case 250:case 137:return"NOP";case 9:case 5:case 21:case 13:case 29:case 25:case 1:case 17:return"ORA";case 72:return"PHA";case 8:return"PHP";case 104:return"PLA";case 40:return"PLP";case 42:case 38:case 54:case 46:case 62:return"ROL";case 106:case 102:case 118:case 110:case 126:return"ROR";case 64:return"RTI";case 96:return"RTS";case 235:case 233:case 229:case 245:case 237:case 253:case 249:case 225:case 241:return"SBC";case 56:return"SEC";case 248:return"SED";case 120:return"SEI";case 133:case 149:case 141:case 157:case 153:case 129:case 145:return"STA";case 134:case 150:case 142:return"STX";case 132:case 148:case 140:return"STY";case 170:return"TAX";case 168:return"TAY";case 186:return"TSX";case 138:return"TXA";case 154:return"TXS";case 152:return"TYA";case 11:case 43:return"AAC";case 75:return"ASR";case 107:return"ARR";case 171:return"ATX"}}}},function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const i=e(0),r=e(21),a=e(22),h=e(23),n=e(24),o=e(25),c=e(26),u=e(27),p=e(28),l=e(29),d=e(30),m=e(31),g=e(8),f=e(32),C=e(33),k=e(34),B=e(35),y=e(36),S=e(37),b=e(38),R=e(39),P=e(40),_=e(9),A={0:r.NesCart,1:n.MMC1Cart,2:r.UxROMCart,3:a.CNROMCart,4:c.MMC3Cart,7:r.AxROMCart,9:o.MMC2Cart,10:o.MMC4Cart,11:r.ColorDreams,13:r.Mapper013Cart,15:B.Mapper015Cart,21:g.Konami021Cart,22:g.KonamiVRC022Cart,23:g.KonamiVRC2Cart,24:f.Konami026Cart,25:g.Konami025Cart,26:f.Konami026Cart,30:r.Mapper030Cart,31:p.Mapper031Cart,34:k.BNROMCart,38:r.BitCorp038Cart,40:l.Smb2jCart,51:h.Mapper051Cart,58:h.Mapper058Cart,66:r.MHROMCart,68:u.Mapper068Cart,70:r.Mapper070Cart,71:r.Mapper071Cart,75:m.KonamiVRC1Cart,77:r.Mapper077Cart,78:r.Mapper078Cart,79:r.Mapper079Cart,81:r.Mapper081Cart,87:r.Mapper087Cart,89:C.Mapper089Cart,93:C.Mapper093Cart,94:r.Mapper094Cart,97:r.Irem097Cart,99:d.VSCart,112:y.Mapper112Cart,132:S.Mapper132Cart,133:b.Mapper133Cart,140:r.JF1xCart,145:r.Mapper145Cart,151:m.KonamiVRC1Cart,152:r.Mapper152Cart,180:r.NesCart,184:C.Mapper184Cart,190:r.Mapper190Cart,193:R.Mapper193Cart,202:h.Mapper202Cart,212:h.Mapper212Cart,228:P.Mapper228Cart};s.iNESFileHandler=(t=>(t=>void 0!==A[t.mapperId]?new A[t.mapperId](t):new i.UnsupportedCart(t))(_.decodeFile(t)))},function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const i=e(0);s.NesCart=class extends i.BaseCart{initializeCart(){switch(this.mapperId){case 0:this.mapperName="NROM";break;case 180:this.mapperName="UNROM (Crazy Climber?)"}this.chrRomCount>0&&this.copyBanks(0,0,0,1),this.setupBankStarts(0,1,2*this.prgRomCount-2,2*this.prgRomCount-1)}setByte(t,s,e){if(s>=24576&&s<=32767)this.SRAMEnabled&&(this.prgRomBank6[8191&s]=255&e);else if(180===this.mapperId&&s>=32768){let t=0;t=2*e,this.setupBankStarts(this.current8,this.currentA,t,t+1|0)}}};s.UxROMCart=class extends i.BaseCart{initializeCart(){this.mapperName="UxROM",this.chrRomCount>0&&this.copyBanks(0,0,0,1),this.setupBankStarts(0,1,2*this.prgRomCount-2,2*this.prgRomCount-1)}setByte(t,s,e){if(s>=32768){let t=e<<1;this.setupBankStarts(t,t+1,this.currentC,this.currentE)}}};s.Mapper094Cart=class extends i.BaseCart{initializeCart(){this.mapperName="HVC-UN1ROM",this.chrRomCount>0&&this.copyBanks(0,0,0,1),this.setupBankStarts(0,1,2*this.prgRomCount-2,2*this.prgRomCount-1)}setByte(t,s,e){if(s>=32768){let t=(e>>2&7)<<1;this.setupBankStarts(t,t+1,this.currentC,this.currentE)}}};s.Mapper081Cart=class extends i.BaseCart{initializeCart(){this.mapperName="Super Gun",this.chrRomCount>0&&this.copyBanks(0,0,0,1),this.setupBankStarts(0,1,2*this.prgRomCount-2,2*this.prgRomCount-1)}setByte(t,s,e){if(s>=32768){let s=(e>>2&3)<<1;this.setupBankStarts(s,s+1,this.currentC,this.currentE);const i=3&e;this.copyBanks(t,0,i,1)}}};s.Mapper030Cart=class extends i.BaseCart{initializeCart(){this.mapperName="UNROM-512",this.chrRomCount>0&&this.copyBanks(0,0,0,1),this.setupBankStarts(0,1,2*this.prgRomCount-2,2*this.prgRomCount-1)}setByte(t,s,e){if(s>=32768){let s=0;s=(31&e)<<1,this.setupBankStarts(s,s+1|0,this.currentC,this.currentE);const i=e>>5&3;this.mirror(0,e>>7&1),this.copyBanks(t,0,i,1)}}};s.Mapper071Cart=class extends i.BaseCart{initializeCart(){this.mapperName="Camerica UNROM",this.chrRomCount>0&&this.copyBanks(0,0,0,1),this.setupBankStarts(0,1,2*this.prgRomCount-2,2*this.prgRomCount-1)}setByte(t,s,e){if(s>=32768){let t=0;t=e<<1,this.setupBankStarts(t,t+1|0,this.currentC,this.currentE)}}};s.Mapper013Cart=class extends i.BaseCart{initializeCart(){this.mapperName="NES-CPROM",this.copyBanks4k(0,0,0,1),this.copyBanks4k(0,1,1,1),this.setupBankStarts(0,1,2,3),this.mirror(0,2)}setByte(t,s,e){s>=32768&&this.copyBanks4k(t,1,3&e,1)}};s.Mapper185Cart=class extends i.BaseCart{initializeCart(){this.mapperName="CNROM + CP",this.setupBankStarts(0,1,2*this.prgRomCount-2,2*this.prgRomCount-1)}setByte(t,s,e){s>=32768&&this.copyBanks(t,0,e,1)}};s.Mapper190Cart=class extends i.BaseCart{initializeCart(){this.mapperName="MKGGROM",this.usesSRAM=!0,this.copyBanks(0,0,0,2),this.setupBankStarts(0,1,0,1),this.mirror(0,1)}setByte(t,s,e){if(this.setPrgRam(s,e),s>=32768&&s<=40959){let t=(7&e)<<1;this.setupBankStarts(t,t+1,this.currentC,this.currentE)}if(s>=40960&&s<=49151&&this.copyBanks2k(t,3&s,e,1),s>=49152&&s<=57343){let t=8+(7&e)<<1;this.setupBankStarts(t,t+1,this.currentC,this.currentE)}}};s.Mapper087Cart=class extends i.BaseCart{initializeCart(){this.mapperName="CNROM Clone",this.chrRomCount>0&&this.copyBanks(0,0,0,1),this.setupBankStarts(0,1,2*this.prgRomCount-2,2*this.prgRomCount-1)}setByte(t,s,e){if(s>=24576&&s<=32767){const s=(1&e)<<1|(2&e)>>1;this.copyBanks(t,0,s,1)}}};s.Mapper145Cart=class extends i.BaseCart{initializeCart(){this.mapperName="Sachen Sidewinder",this.chrRomCount>0&&this.copyBanks(0,0,0,1),this.setupBankStarts(0,1,2,3)}setByte(t,s,e){if(16640==(57600&s)){const s=e;this.copyBanks(t,0,s,1)}}};s.ColorDreams=class extends i.BaseCart{initializeCart(){this.mapperName="Color Dreams",this.setupBankStarts(0,1,2,3)}setByte(t,s,e){if(s>=32768&&s<=65535){const s=(3&e)<<2,i=e>>4&15;this.setupBankStarts(s,s+1,s+2,s+3),this.copyBanks(t,0,i,1)}}};s.MHROMCart=class extends i.BaseCart{initializeCart(){this.mapperName="GxROM",this.chrRomCount>0&&this.copyBanks(0,0,0,1),this.setupBankStarts(0,1,2,3)}setByte(t,s,e){if(s>=32768&&s<=65535){const s=3&e,i=(e>>4&3)<<2;this.setupBankStarts(i,i+1,i+2,i+3),this.copyBanks(t,0,s,1)}}};s.Mapper070Cart=class extends i.BaseCart{initializeCart(){this.mapperName="~Family Trainer",this.chrRomCount>0&&this.copyBanks(0,0,0,1),this.setupBankStarts(0,1,2*this.prgRomCount-2,2*this.prgRomCount-1),this.mirror(0,1)}setByte(t,s,e){if(s>=32768&&s<=65535){const s=15&e,i=(e>>4&15)<<1;this.setupBankStarts(i,i+1,this.currentC,this.currentE),this.copyBanks(t,0,s,1),this.oneScreenOffset=e>>7==1?1024:0,this.mirror(t,0)}}};s.Mapper077Cart=class extends i.BaseCart{initializeCart(){this.mapperName="~Mapper 077",this.chrRomCount>0&&this.copyBanks(0,0,0,1),this.setupBankStarts(0,1,2*this.prgRomCount-2,2*this.prgRomCount-1)}setByte(t,s,e){if(s>=32768&&s<=65535){const s=(15&e)<<2,i=e>>4&15;this.setupBankStarts(s,s+1,s+2,s+3),this.copyBanks2k(t,0,i,1)}}};s.Mapper079Cart=class extends i.BaseCart{initializeCart(){this.mapsBelow6000=!0,this.usesSRAM=!1,this.mapperName="NINA-003-006",this.chrRomCount>0&&this.copyBanks(0,0,0,2),this.setupBankStarts(2*this.prgRomCount-4,2*this.prgRomCount-3,2*this.prgRomCount-2,2*this.prgRomCount-1)}setByte(t,s,e){if(s>>13==2&&256&s){const s=(e>>3&1)<<2;this.setupBankStarts(s,s+1,s+2,s+3);const i=7&e;this.copyBanks(t,0,i,1)}}};s.Mapper078Cart=class extends i.BaseCart{constructor(){super(...arguments),this.isHolyDiver=!1}initializeCart(){this.mapperName="Holy Diver / Cosmo Carrier",this.chrRomCount>0&&this.copyBanks(0,0,0,1),"BA51AC6F"==this.ROMHashFunction?(this.isHolyDiver=!0,this.mirror(0,1)):this.mirror(0,0),this.setupBankStarts(0,1,2*this.prgRomCount-2,2*this.prgRomCount-1)}setByte(t,s,e){if(s>=32768&&s<=65535){const s=(15&e)<<1,i=e>>4&15,r=e>>3&1;this.setupBankStarts(s,s+1,this.currentC,this.currentE),this.copyBanks(t,0,i,1),this.isHolyDiver?0==r?this.mirror(t,2):this.mirror(t,1):(this.oneScreenOffset=1024*r,this.mirror(t,0))}}};s.Mapper152Cart=class extends i.BaseCart{initializeCart(){this.mapperName="~FT + onescreen mirroring",this.chrRomCount>0&&this.copyBanks(0,0,0,1),this.setupBankStarts(0,1,2*this.prgRomCount-2,2*this.prgRomCount-1),this.oneScreenOffset=0,this.mirror(0,0)}setByte(t,s,e){if(s>=32768&&s<=65535){const s=15&e,i=(e>>4&49)<<1;this.setupBankStarts(i,i+1,this.currentC,this.currentE),this.copyBanks(t,0,s,1),this.oneScreenOffset=e>>7==1?1024:0,this.mirror(t,0)}}};s.JF1xCart=class extends i.BaseCart{initializeCart(){this.mapperName="Jaleco JF-11, JF-14",this.chrRomCount>0&&this.copyBanks(0,0,0,1),this.setupBankStarts(0,1,2,3)}setByte(t,s,e){if(s>=24576&&s<=32767){const s=15&e,i=(e>>4&3)<<2;this.setupBankStarts(i,i+1,i+2,i+3),this.copyBanks(t,0,s,1)}}};s.Irem097Cart=class extends i.BaseCart{initializeCart(){this.mapperName="~Irem TAM-S1 IC",this.usesSRAM=!1,this.chrRomCount>0&&this.copyBanks(0,0,0,1),this.setupBankStarts(2*this.prgRomCount-2,2*this.prgRomCount-1,0,1)}setByte(t,s,e){if(s>=32768&&s<=65535){let s=0;switch(s=(15&e)<<1,this.setupBankStarts(this.current8,this.currentA,s,s+1),e>>6&3){case 0:this.oneScreenOffset=0,this.mirror(t,0);break;case 1:this.mirror(t,2);break;case 2:this.mirror(t,1);break;case 2:this.oneScreenOffset=1024,this.mirror(t,0)}}}};s.BitCorp038Cart=class extends i.BaseCart{initializeCart(){this.mapperName="Bit Corp Crime Busters",this.chrRomCount>0&&this.copyBanks(0,0,0,1),this.setupBankStarts(0,1,2,3)}setByte(t,s,e){if(s>=28672&&s<=32767){const s=(3&e)<<2,i=e>>2&3;this.setupBankStarts(s,s+1,s+2,s+3),this.copyBanks(t,0,i,1)}}};s.AxROMCart=class extends i.BaseCart{initializeCart(){this.mapperName="AxROM",this.setupBankStarts(0,1,2,3),this.mirror(0,0)}setByte(t,s,e){if(s>=32768&&s<=65535){let s=0;s=(7&e)<<2,this.setupBankStarts(s,s+1,s+2,s+3),this.oneScreenOffset=16&e?1024:0,this.mirror(t,0)}}}},function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const i=e(0);s.CNROMCart=class extends i.BaseCart{initializeCart(){this.mapperName="CNROM",this.usesSRAM=!1,1==this.prgRomCount?this.setupBankStarts(0,1,0,1):this.setupBankStarts(0,1,2,3)}setByte(t,s,e){if(s>=32768&&s<=65535){let s=15&e;this.copyBanks(t,0,s,1)}}}},function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const i=e(0);s.Mapper051Cart=class extends i.BaseCart{constructor(){super(...arguments),this.bank=0,this.mode=0}initializeCart(){this.usesSRAM=!0,this.mapperName="Ball Games 11 in 1",this.chrRomCount>0&&this.copyBanks(0,0,0,1),this.setupBankStarts(0,1,2,3)}updateBanks(){let t=0;if(1&this.mode){let s=this.bank<<2;this.setupBankStarts(s,s+1,s+2,s+3),t=35}else{let s=this.bank<<1;this.setupBankStarts(s,s+1,this.currentC,this.currentE),t=47}3==this.mode?this.mirror(0,1):this.mirror(0,2)}setByte(t,s,e){switch(57344&s){case 24576:this.mode=e>>3&2|e>>1&1,this.updateBanks();break;case 32768:this.bank=15&e,this.updateBanks();break;case 49152:this.bank=15&e,this.mode=e>>3&2|1&this.mode}}};s.Mapper058Cart=class extends i.BaseCart{initializeCart(){this.mapperName="Charlie Multi-Cart",this.chrRomCount>0&&this.copyBanks(0,0,0,1),this.setupBankStarts(0,1,2,3)}setByte(t,s,e){if(s>=32768){if(s>>6&1){let t=(7&s)<<1;this.setupBankStarts(t,t+1,t,t+1)}else{let t=0;t=(7&s)<<2,this.setupBankStarts(t,t+1,t+2,t+3)}this.mirror(t,1+(s>>7&1)),this.copyBanks(t,0,s>>3&7,1)}}};s.Mapper202Cart=class extends i.BaseCart{initializeCart(){this.mapperName="Multi-Cart",this.chrRomCount>0&&this.copyBanks(0,0,0,1),this.setupBankStarts(0,1,0,1)}setByte(t,s,e){if(s>=32768){let e=s>>1&7;if(1&s|s>>2&2){let t=e>>1<<2;this.setupBankStarts(t,t+1,t+2,t+3)}else{let t=e>>1<<1;this.setupBankStarts(t,t+1,t,t+1)}this.mirror(t,1+(1&s)),this.copyBanks(t,0,e,1)}}};s.Mapper212Cart=class extends i.BaseCart{initializeCart(){this.mapperName="Multi-Cart212",this.chrRomCount>0&&this.copyBanks(0,0,0,2),this.setupBankStarts(0,1,3,4)}setByte(t,s,e){if(s>=32768&&s<=65535){let e=7&s;if(1==(s>>14&1)){let t=(6&s)<<2;this.setupBankStarts(t,t+1,t+2,t+3)}else{let t=e<<1;this.setupBankStarts(t,t+1,t,t+1)}this.mirror(t,1+(s>>3&1)),this.copyBanks(t,0,e,1)}}}},function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const i=e(0);s.MMC1Cart=class extends i.BaseCart{constructor(){super(...arguments),this.chrRomBankMode=0,this.prgRomBankMode=0,this.lastClock=0,this.sequence=0,this.accumulator=0,this.bank_select=0,this._registers=new Array(4),this.lastwriteAddress=0}initializeCart(){this.mapperName="MMC1",this.usesSRAM=!0,this.mapsBelow6000=!1,this.ramMask=8191,this.chrRomCount>0&&this.copyBanks(0,0,0,2),this._registers[0]=12,this._registers[1]=0,this._registers[2]=0,this._registers[3]=0,this.setupBankStarts(0,1,2*this.prgRomCount-2,2*this.prgRomCount-1),this.sequence=0,this.accumulator=0}setByte(t,s,e){switch(61440&s){case 24576:case 28672:this.prgRomBank6[8191&s]=255&e;break;default:if(this.lastwriteAddress=s,128==(128&e)?(this._registers[0]=12|this._registers[0],this.accumulator=0,this.sequence=0):(1==(1&e)&&(this.accumulator=this.accumulator|1<<this.sequence),this.sequence++),5===this.sequence){const e=(32767&s)>>13;switch(this._registers[e]=this.accumulator,this.sequence=0,this.accumulator=0,e){case 0:this.setMMC1Mirroring(t),this.prgRomBankMode=this._registers[0]>>2&3,this.chrRomBankMode=this._registers[0]>>4&1;break;case 1:case 2:this.setMMC1ChrBanking(t);break;case 3:this.setMMC1PrgBanking()}}}}setMMC1ChrBanking(t){1===this.chrRomBankMode?(this.copyBanks4k(t,0,this._registers[1],1),this.copyBanks4k(t,1,this._registers[2],1)):(this.copyBanks4k(t,0,this._registers[1],1),this.copyBanks4k(t,1,this._registers[1]+1,1))}setMMC1PrgBanking(){let t=0;32===this.prgRomCount?this.bank_select=(16&this._registers[1])<<1:this.bank_select=0,0==(8&this._registers[0])?(t=4*(this._registers[3]>>1&15)+this.bank_select,this.setupBankStarts(t,t+1,t+2,t+3)):(t=2*this._registers[3]+this.bank_select,4==(4&this._registers[0])?this.setupBankStarts(t,t+1,(this.prgRomCount<<1)-2,(this.prgRomCount<<1)-1):this.setupBankStarts(0,1,t,t+1))}setMMC1Mirroring(t){switch(3&this._registers[0]){case 0:this.oneScreenOffset=0,this.mirror(t,0);break;case 1:this.oneScreenOffset=1024,this.mirror(t,0);break;case 2:this.mirror(t,1);break;case 3:this.mirror(t,2)}}}},function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const i=e(0);s.MMC2Cart=class extends i.BaseCart{constructor(){super(...arguments),this.latches=[0,0],this.banks=[0,0,0,0]}initializeCart(){this.mapperName="MMC2",this.latches[0]=1,this.latches[1]=2,this.banks[0]=0,this.banks[1]=0,this.banks[2]=0,this.banks[3]=0,this.setupBankStarts(0,2*this.prgRomCount-3,2*this.prgRomCount-2,2*this.prgRomCount-1),this.copyBanks4k(0,0,this.banks[this.latches[0]],1),this.copyBanks4k(0,1,this.banks[this.latches[1]],1)}getPPUByte(t,s){var e=0;return 4056==s?(e=s>>11&2,this.latches[0]=e,this.copyBanks4k(t,0,this.banks[this.latches[0]],1)):4072==s?(e=s>>11&2|1,this.latches[0]=e,this.copyBanks4k(t,0,this.banks[this.latches[0]],1)):s>=8152&&s<=8159?(e=s>>11&2,this.latches[1]=e,this.copyBanks4k(t,1,this.banks[this.latches[1]],1)):s>=8168&&s<=8175&&(e=s>>11&2|1,this.latches[1]=e,this.copyBanks4k(t,1,this.banks[this.latches[1]],1)),super.getPPUByte(t,s)}setByte(t,s,e){switch(s>>12){case 6:case 7:this.prgRomBank6[8191&s]=255&e;break;case 10:this.setupBankStarts(15&e,this.currentA,this.currentC,this.currentE);break;case 11:case 12:this.banks[s-45056>>12]=31&e,this.copyBanks4k(t,0,this.banks[this.latches[0]],1);break;case 13:case 14:this.banks[s-45056>>12]=31&e,this.copyBanks4k(t,1,this.banks[this.latches[1]],1);break;case 15:this.mirror(t,1+(1&e))}}};s.MMC4Cart=class extends i.BaseCart{constructor(){super(...arguments),this.selector=[0,0],this.banks=[0,0,0,0]}initializeCart(){this.mapperName="MMC4",this.selector[0]=1,this.selector[1]=2,this.banks[0]=0,this.banks[1]=0,this.banks[2]=0,this.banks[3]=0,this.setupBankStarts(0,1,2*this.prgRomCount-2,2*this.prgRomCount-1),this.copyBanks4k(0,0,this.banks[this.selector[0]],1),this.copyBanks4k(0,1,this.banks[this.selector[1]],1)}getPPUByte(t,s){var e=0;s>=4056&&s<=4063?(e=s>>11&2,this.selector[0]=e,this.copyBanks4k(t,0,this.banks[this.selector[0]],1)):s>=4072&&s<=4079?(e=s>>11&2|1,this.selector[0]=e,this.copyBanks4k(t,0,this.banks[this.selector[0]],1)):s>=8152&&s<=8159?(e=s>>11&2,this.selector[1]=e,this.copyBanks4k(t,1,this.banks[this.selector[1]],1)):s>=8168&&s<=8175&&(e=s>>11&2|1,this.selector[1]=e,this.copyBanks4k(t,1,this.banks[this.selector[1]],1)),e=s>>10;let i=this.ppuBankStarts[e]+(1023&s);return this.chrRom[i]}setByte(t,s,e){switch(s>>12){case 6:case 7:this.SRAMEnabled&&this.SRAMCanWrite&&(this.prgRomBank6[8191&s]=255&e);break;case 10:const i=(15&e)<<1;this.setupBankStarts(i,i+1,this.currentC,this.currentE);break;case 11:case 12:this.banks[s-45056>>12]=31&e,this.copyBanks4k(t,0,this.banks[this.selector[0]],1),this.Whizzler.unpackSprites();break;case 13:case 14:this.banks[s-45056>>12]=31&e,this.copyBanks4k(t,1,this.banks[this.selector[1]],1);break;case 15:this.mirror(t,1+(1&e))}}}},function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const i=e(0);s.MMC3Cart=class extends i.BaseCart{constructor(){super(...arguments),this._registers=new Uint8Array(4),this.chr2kBank0=0,this.chr2kBank1=1,this.chr1kBank0=0,this.chr1kBank1=0,this.chr1kBank2=0,this.chr1kBank3=0,this.prgSwap=0,this.prgSwitch1=0,this.prgSwitch2=0,this.prevBSSrc=new Uint8Array(8),this._mmc3Command=0,this._mmc3ChrAddr=0,this._mmc3IrqVal=0,this._mmc3TmpVal=0,this.scanlineCounter=0,this._mmc3IrcOn=!1,this.ppuBankSwap=!1,this.PPUBanks=new Uint32Array(8)}initializeCart(){this.usesSRAM=!0,this.mapperName="MMC3",this._registers.fill(0),this.PPUBanks.fill(0),this.prevBSSrc.fill(0),this.prgSwap=1,this.prgSwitch1=0,this.prgSwitch2=1,this.swapPrgBanks(),this._mmc3IrqVal=0,this._mmc3IrcOn=!1,this._mmc3TmpVal=0,this.chr2kBank0=0,this.chr2kBank1=0,this.chr1kBank0=0,this.chr1kBank1=0,this.chr1kBank2=0,this.chr1kBank3=0,this.chrRomCount>0&&this.copyBanks1k(0,0,0,8)}setByte(t,s,e){if(s>=24576&&s<32768)this.SRAMEnabled&&this.SRAMCanWrite&&(this.prgRomBank6[8191&s]=255&e);else switch(57345&s){case 32768:this._mmc3Command=7&e,128==(128&e)?(this.ppuBankSwap=!0,this._mmc3ChrAddr=4096):(this.ppuBankSwap=!1,this._mmc3ChrAddr=0),this.prgSwap=64==(64&e)?1:0,this.swapPrgBanks();break;case 32769:switch(this._mmc3Command){case 0:this.chr2kBank0=e,this.swapChrBanks();break;case 1:this.chr2kBank1=e,this.swapChrBanks();break;case 2:this.chr1kBank0=e,this.swapChrBanks();break;case 3:this.chr1kBank1=e,this.swapChrBanks();break;case 4:this.chr1kBank2=e,this.swapChrBanks();break;case 5:this.chr1kBank3=e,this.swapChrBanks();break;case 6:this.prgSwitch1=e,this.swapPrgBanks();break;case 7:this.prgSwitch2=e,this.swapPrgBanks()}break;case 40960:1==(1&e)?this.mirror(t,2):this.mirror(t,1);break;case 40961:this.SRAMCanWrite=0==(64&e),this.SRAMEnabled=128==(128&e);break;case 49152:this._mmc3IrqVal=e,0===e&&(this.scanlineCounter=0,this.irqRaised=!0);break;case 49153:this._mmc3TmpVal=this._mmc3IrqVal;break;case 57344:this._mmc3IrcOn=!1,this.irqRaised=!1;break;case 57345:this._mmc3IrcOn=!0}}swapChrBanks(){this.ppuBankSwap?(this.copyBanks1k(0,0,this.chr1kBank0,1),this.copyBanks1k(0,1,this.chr1kBank1,1),this.copyBanks1k(0,2,this.chr1kBank2,1),this.copyBanks1k(0,3,this.chr1kBank3,1),this.copyBanks1k(0,4,this.chr2kBank0,2),this.copyBanks1k(0,6,this.chr2kBank1,2)):(this.copyBanks1k(0,4,this.chr1kBank0,1),this.copyBanks1k(0,5,this.chr1kBank1,1),this.copyBanks1k(0,6,this.chr1kBank2,1),this.copyBanks1k(0,7,this.chr1kBank3,1),this.copyBanks1k(0,0,this.chr2kBank0,2),this.copyBanks1k(0,2,this.chr2kBank1,2))}swapPrgBanks(){1===this.prgSwap?this.setupBankStarts(2*this.prgRomCount-2,this.prgSwitch2,this.prgSwitch1,2*this.prgRomCount-1):this.setupBankStarts(this.prgSwitch1,this.prgSwitch2,2*this.prgRomCount-2,2*this.prgRomCount-1)}updateScanlineCounter(){if(0===this.scanlineCounter){if(this.scanlineCounter=this._mmc3IrqVal,0===this._mmc3IrqVal)return this._mmc3IrcOn&&(this.irqRaised=!0),void(this.scanlineCounter=-1);this.scanlineCounter=this._mmc3IrqVal}0!==this._mmc3TmpVal?(this.scanlineCounter=this._mmc3TmpVal,this._mmc3TmpVal=0):this.scanlineCounter=this.scanlineCounter+1&255}}},function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const i=e(0);s.Mapper068Cart=class extends i.BaseCart{constructor(){super(...arguments),this.cramStart=0,this.cromStart=0}initializeCart(){this.mapperName="Sunsoft-4",this.setupBankStarts(0,1,2*this.prgRomCount-2,2*this.prgRomCount-1),this.cramStart=this.chrRamStart}setByte(t,s,e){if(!(s<20480))if(s>=24576&&s<=32767)this.SRAMEnabled&&(this.prgRomBank6[8191&s]=255&e);else switch(61440&s){case 61440:let i=15*e<<1;this.setupBankStarts(i,i+1,this.currentC,this.currentE);break;case 32768:this.copyBanks2k(t,0,e,1);break;case 36864:this.copyBanks2k(t,1,e,1);break;case 40960:this.copyBanks2k(t,2,e,1);break;case 45056:this.copyBanks2k(t,3,e,1);break;case 49152:this.cromStart=1024*(128|e),this.chrRamStart=this.cromStart,this.copyBanks1k(t,8,128|e,1);break;case 53248:this.copyBanks1k(t,9,128|e,1);break;case 57344:let r=16==(16&e);this.chrRamStart=r?this.cramStart:this.cromStart,this.mirror(t,3&e)}}}},function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const i=e(0);s.Mapper031Cart=class extends i.BaseCart{constructor(){super(...arguments),this.mapsBelow6000=!0,this.registers=[0,0,0,0,0,0,0,255]}initializeCart(){this.mapperName="NSF Compilation",this.setupBanks4k(2,this.registers)}setByte(t,s,e){24560==(65520&s)&&(this.registers[7&s]=e,this.setupBanks4k(2,this.registers))}}},function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const i=e(0);s.Smb2jCart=class extends i.BaseCart{constructor(){super(...arguments),this.irqEnabled=!1,this.irqCounter=0}initializeCart(){this.mapperName="Smb2j pirate",this.usesSRAM=!1,this.setup6BankStarts(6,4,5,1,7),this.copyBanks(0,0,0,1)}advanceClock(t){this.irqEnabled&&(this.irqCounter-=t,this.irqCounter<=0&&(this.irqCounter=0,this.irqRaised=!0,this.irqEnabled=!1))}getByte(t,s){return this.prgRom[this.prgBankStarts[(s>>12)-6]+(4095&s)]}setByte(t,s,e){switch(57344&s){case 32768:this.irqRaised=!1,this.irqEnabled=!1;break;case 40960:this.irqEnabled=!0,this.irqCounter=4096,this.nextEventAt=t+4096;break;case 57344:this.setup6BankStarts(this.current6,this.current8,this.currentA,e,this.currentE)}}}},function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const i=e(0);s.VSCart=class extends i.BaseCart{constructor(){super(...arguments),this.coin=0,this.dips1=0,this.dips2=0,this.customPalette=[430,326,44,660,0,755,14,630,555,310,70,3,764,770,4,572,737,200,27,747,0,222,510,740,653,53,447,140,403,0,473,357,503,31,420,6,407,507,333,704,22,666,36,20,111,773,444,707,757,777,320,700,760,276,777,467,0,750,637,567,360,657,77,120],this.reg16=0,this.bankSelect=0,this.clocks=0}initializeCart(){this.mapperName="VS Unisystem",this.mapsBelow6000=!0,this.setupBankStarts(0,2*this.prgRomCount-3,2*this.prgRomCount-2,2*this.prgRomCount-1),this.copyBanks(0,0,0,1),this.mirror(0,3)}getByte(t,s){return 16416==s?this.coin:s>=32768?this.peekByte(s):void 0}setByte(t,s,e){if(this.setPrgRam(s,e),16406==s){this.bankSelect=e;const s=e>>2&1;this.prgRomCount>2&&this.setupBankStarts(s,2*this.prgRomCount-3,2*this.prgRomCount-2,2*this.prgRomCount-1),this.copyBanks(t,0,s,1)}16416===s&&(this.coin=e)}}},function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const i=e(0);s.KonamiVRC1Cart=class extends i.BaseCart{constructor(){super(...arguments),this.chrLatches=[0,0,0,0,0,0,0,0]}initializeCart(){this.mapperName="KonamiVRC1",151==this.mapperId&&(this.mapperName="KonamiVRC1 (VS)",this.fourScreen=!0,this.mirror(0,3)),this.setupBankStarts(0,0,2*this.prgRomCount-2,2*this.prgRomCount-1),this.copyBanks4k(0,0,0,2)}setByte(t,s,e){switch(61440&s){case 32768:let i=15&e;this.setupBankStarts(i,this.currentA,this.currentC,this.currentE);break;case 40960:let r=15&e;this.setupBankStarts(this.current8,r,this.currentC,this.currentE);break;case 49152:let a=15&e;this.setupBankStarts(this.current8,this.currentA,a,this.currentE);break;case 36864:this.fourScreen||(1==(1&e)?this.mirror(t,2):this.mirror(t,1)),this.chrLatches[0]=(e>>1&1)<<4,this.chrLatches[2]=(e>>2&1)<<4,this.syncChrBanks(t);break;case 57344:this.chrLatches[1]=15&e,this.syncChrBanks(t);break;case 61440:this.chrLatches[3]=15&e,this.syncChrBanks(t)}}syncChrBanks(t){this.copyBanks4k(t,0,this.chrLatches[0]|this.chrLatches[1],1),this.copyBanks4k(t,1,this.chrLatches[2]|this.chrLatches[3],1)}}},function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const i=e(8);s.Konami026Cart=class extends i.VRCIrqBase{constructor(){super(...arguments),this.runCounter=!1,this.chrselect=0,this.chrA10Mode=!1,this.nameTableSource=!1,this.mirrorMode=0,this.bankMode=0,this.prgRamEnable=!1,this.swapMode=!1,this.microwireLatch=0,this.vrc6Registers=[0,0,0,0,0,0,0,0]}updateChrBanks(t){this.copyBanks1k(t,0,this.vrc6Registers[0],1);let s=this.vrc6Registers[1];switch(3&this.chrselect){case 1:s=this.vrc6Registers[0]}switch(this.copyBanks1k(t,1,s,1),s=this.vrc6Registers[2],3&this.chrselect){case 1:s=this.vrc6Registers[1]}switch(this.copyBanks1k(t,2,s,1),s=this.vrc6Registers[3],3&this.chrselect){case 1:s=this.vrc6Registers[1]}switch(this.copyBanks1k(t,3,s,1),s=this.vrc6Registers[4],3&this.chrselect){case 1:s=this.vrc6Registers[2]}switch(this.copyBanks1k(t,4,s,1),s=this.vrc6Registers[5],3&this.chrselect){case 1:s=this.vrc6Registers[2];break;case 2:case 3:s=this.vrc6Registers[4]}switch(this.copyBanks1k(t,5,s,1),s=this.vrc6Registers[6],3&this.chrselect){case 1:s=this.vrc6Registers[3];break;case 2:case 3:s=this.vrc6Registers[5]}switch(this.copyBanks1k(t,6,s,1),s=this.vrc6Registers[7],3&this.chrselect){case 1:s=this.vrc6Registers[3];break;case 2:case 3:s=this.vrc6Registers[5]}switch(this.copyBanks1k(t,7,s,1),7&this.chrselect){case 1:case 5:s=this.vrc6Registers[4];break;case 2:case 3:case 4:case 0:case 6:case 7:s=this.vrc6Registers[6]}switch(this.copyBanks1k(t,8,s,1),7&this.chrselect){case 1:case 5:s=this.vrc6Registers[5];break;case 2:case 3:case 4:s=this.vrc6Registers[7];break;case 0:case 6:case 7:s=this.vrc6Registers[6]}switch(this.copyBanks1k(t,9,s,1),7&this.chrselect){case 1:case 5:case 2:case 3:case 4:s=this.vrc6Registers[6];break;case 0:case 6:case 7:s=this.vrc6Registers[7]}this.copyBanks1k(t,10,s,1),this.copyBanks1k(t,11,this.vrc6Registers[7],1),this.chrselect}initializeCart(){this.mapperName="KonamiVRC6",this.setupBankStarts(0,0,2*this.prgRomCount-2,2*this.prgRomCount-1),this.copyBanks4k(0,0,0,2)}setByte(t,s,e){switch(61440&s){case 32768:if(s<=32771){let t=(15&e)<<1;this.setupBankStarts(t,t+1,this.currentC,this.currentE)}break;case 49152:if(s<=49155){let t=15&e;this.setupBankStarts(this.current8,this.currentA,t,this.currentE)}break;case 45056:3==(3&s)&&(this.chrselect=e,this.prgRamEnable=128==(128&e),this.bankMode=3&e,this.mirrorMode=e>>2&3,this.nameTableSource=1==(e>>4&1),this.chrA10Mode=1==(e>>5&1),this.updateChrBanks(t));break;case 53248:s<=53251&&(this.vrc6Registers[3&s]=e,this.updateChrBanks(t));break;case 57344:s<=57347&&(this.vrc6Registers[4+(3&s)]=e,this.updateChrBanks(t));break;case 61440:switch(3&s){case 0:this.irqLatch=e;break;case 1:this.irqControl=e;break;case 2:this.ackIrq()}}}}},function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const i=e(0);s.Mapper093Cart=class extends i.BaseCart{initializeCart(){this.usesSRAM=!0,this.mapperName="Sunsoft-2",this.setupBankStarts(0,1,2*this.prgRomCount-2,2*this.prgRomCount-1)}setByte(t,s,e){if(s>=32768&&s<=65535){const t=(e>>4&7)<<1;this.setupBankStarts(t,t+1,this.currentC,this.currentE)}}};s.Mapper089Cart=class extends i.BaseCart{initializeCart(){this.mapperName="Sunsoft-2 on 3",this.setupBankStarts(0,1,2*this.prgRomCount-2,2*this.prgRomCount-1)}setByte(t,s,e){if(s>=32768&&s<=65535){let s=7&e;s|=e>>4&8;const i=(e>>4&7)<<1;this.oneScreenOffset=8&e?1024:0,this.mirror(t,0),this.setupBankStarts(i,i+1,this.currentC,this.currentE),this.copyBanks(t,0,s,1)}}};s.Mapper184Cart=class extends i.BaseCart{initializeCart(){this.usesSRAM=!1,this.mapperName="Sunsoft-1",this.setupBankStarts(0,1,2*this.prgRomCount-2,2*this.prgRomCount-1),this.copyBanks4k(0,0,3,1),this.copyBanks4k(0,1,0,1)}setByte(t,s,e){if(s>=24576&&s<=32767){const s=3&e,i=e>>4&15;this.copyBanks4k(t,0,s,1),this.copyBanks4k(t,1,i,1)}}}},function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const i=e(0);s.BNROMCart=class extends i.BaseCart{constructor(){super(...arguments),this.isNina=!1}initializeCart(){this.mapperName="BNROM",this.setupBankStarts(0,1,2,3),this.chrRomCount>1&&(this.usesSRAM=!0,this.mapperName="NINA-001",this.isNina=!0,this.setByte=this.SetByteNina,this.setupBankStarts(0,1,2*this.prgRomCount-2,2*this.prgRomCount-1))}setByte(t,s,e){var i;s>=32768&&s<=65535&&(i=(15&e)<<2,this.setupBankStarts(i,i+1,i+2,i+3))}SetByteNina(t,s,e){if(s>=24576&&s<=32767)this.prgRomBank6[8191&s]=255&e;else switch(s){case 32765:let i=0;i=(1&e)<<2,this.setupBankStarts(i,i+1,i+2,i+3);break;case 32766:this.copyBanks4k(t,0,15&e,1);break;case 32767:this.copyBanks4k(t,1,15&e,1)}}}},function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const i=e(0);s.Mapper015Cart=class extends i.BaseCart{initializeCart(){this.mapperName="Contra 100-in-1",this.usesSRAM=!0,this.setupBankStarts(0,1,2,3),this.mirror(0,2)}setByte(t,s,e){if(s>=24576&&s<=65535)this.prgRomBank6[8191&s]=e;else if(s>=32768&&s<=65535){const i=3&s;let r=63&e,a=e>>7&1;const h=e>>6&1;switch(this.mirror(t,2-h),i){case 0:r<<=2,this.setupBankStarts(r^a,r+1^a,r+2^a,r+3^a);break;case 2:r|=a,this.setupBankStarts(r,r,r,r);break;case 1:case 3:r<<=1,r|=a,this.setupBankStarts(r,r+1,~s>>1&1,r+1)}}}}},function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const i=e(0);s.Mapper112Cart=class extends i.BaseCart{constructor(){super(...arguments),this.registers=[0,0,0,0,0,0,0,0],this.latch=0}initializeCart(){this.mapperName="asder",this.setupBankStarts(0,1,2*this.prgRomCount-2,2*this.prgRomCount-1)}updateBanks(){this.setupBankStarts(this.registers[0],this.registers[1],this.currentC,this.currentE),this.copyBanks2k(0,0,this.registers[2],1),this.copyBanks2k(0,1,this.registers[3],1),this.copyBanks1k(0,4,this.registers[4],1),this.copyBanks1k(0,5,this.registers[5],1),this.copyBanks1k(0,6,this.registers[6],1),this.copyBanks1k(0,7,this.registers[7],1)}setByte(t,s,e){if(s>=32768&&s<=65535)switch(57345&s){case 32768:this.latch=7&e;break;case 40960:this.registers[this.latch]=e,this.updateBanks();case 57344:this.mirror(t,1==(1&e)?1:2)}}}},function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const i=e(0);s.Mapper132Cart=class extends i.BaseCart{constructor(){super(...arguments),this.registers=[0,0,0,0]}initializeCart(){this.mapperName="Mapper 132",this.mapsBelow6000=!0,this.usesSRAM=!1,this.setupBankStarts(0,1,2*this.prgRomCount-2,2*this.prgRomCount-1),this.copyBanks(0,0,this.chrRomCount-1,1),this.mirror(0,1)}getByte(t,s){let e=(s>>12)-6;return s>=16640&&s<=16643?this.registers[1]^this.registers[2]|64:this.prgRom[this.prgBankStarts[e]+(4095&s)]}setByte(t,s,e){if(s>=16640&&s<=16643)this.registers[3&s]=e;else if(s>=32768&&s<=65535){const s=this.registers[2]<<2;this.setupBankStarts(s,s+1,s+2,s+3),this.copyBanks(t,0,this.registers[2],1)}}}},function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const i=e(0);s.Mapper133Cart=class extends i.BaseCart{initializeCart(){this.mapperName="Jovial Race (Sachen)",this.usesSRAM=!1,this.mapsBelow6000=!0,this.setupBankStarts((this.prgRomCount<<1)-4,(this.prgRomCount<<1)-3,(this.prgRomCount<<1)-2,(this.prgRomCount<<1)-1),this.copyBanks(0,0,0,1),this.mirror(0,1)}setByte(t,s,e){if(s>=16640&&s<=24576){const s=3&e;this.copyBanks(t,0,s,1);const i=(e>>2&1)<<2;this.setupBankStarts(i,i+1,i+2,i+3)}}}},function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const i=e(0);s.Mapper193Cart=class extends i.BaseCart{initializeCart(){this.mapperName="NTDEC TC-112",this.usesSRAM=!1,this.setupBankStarts(0,2*this.prgRomCount-3,2*this.prgRomCount-2,2*this.prgRomCount-1),this.copyBanks(0,0,this.chrRomCount-1,1),this.mirror(0,1)}setByte(t,s,e){if(console.log("set: 0x"+s.toString(16)+"( 0x"+e.toString(16)+")"),s>=24576&&s<=32767)switch(3&s){case 0:this.copyBanks4k(t,0,e>>2&63,1);break;case 1:this.copyBanks2k(t,2,e>>1,1);break;case 2:this.copyBanks2k(t,3,e>>1,1);break;case 3:this.setupBankStarts(e,this.currentA,this.currentC,this.currentE)}}}},function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const i=e(0);s.Mapper228Cart=class extends i.BaseCart{initializeCart(){this.mapperName="Cheetahmen II/Action 52",this.usesSRAM=!1,this.setupBankStarts(0,1,2*this.prgRomCount-2,2*this.prgRomCount-1),this.copyBanks(0,0,0,1),this.mirror(0,1),this.setByte(0,32768,0)}setByte(t,s,e){if(s>32768&&s<65535){const i=s>>5&1,r=3&e|(15&s)<<4,a=s>>5&1,h=s>>13&1;let n=s>>6&31;if(this.copyBanks(t,0,r,1),a)n<<=2,this.setupBankStarts(n,n+1,n+2,n+3);else switch(i){case 1:n<<=1,this.setupBankStarts(n,n+1,n,n+1);case 0:let t=(254&n)<<1,s=(255&n)<<1;this.setupBankStarts(t,t+1,s,s+1)}this.mirror(t,2-h)}}}},function(t,s,e){"use strict";(function(t){var i=e(43),r=e(44),a=e(45);function h(){return o.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function n(t,s){if(h()<s)throw new RangeError("Invalid typed array length");return o.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(s)).__proto__=o.prototype:(null===t&&(t=new o(s)),t.length=s),t}function o(t,s,e){if(!(o.TYPED_ARRAY_SUPPORT||this instanceof o))return new o(t,s,e);if("number"==typeof t){if("string"==typeof s)throw new Error("If encoding is specified then the first argument must be a string");return p(this,t)}return c(this,t,s,e)}function c(t,s,e,i){if("number"==typeof s)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&s instanceof ArrayBuffer?function(t,s,e,i){if(s.byteLength,e<0||s.byteLength<e)throw new RangeError("'offset' is out of bounds");if(s.byteLength<e+(i||0))throw new RangeError("'length' is out of bounds");s=void 0===e&&void 0===i?new Uint8Array(s):void 0===i?new Uint8Array(s,e):new Uint8Array(s,e,i);o.TYPED_ARRAY_SUPPORT?(t=s).__proto__=o.prototype:t=l(t,s);return t}(t,s,e,i):"string"==typeof s?function(t,s,e){"string"==typeof e&&""!==e||(e="utf8");if(!o.isEncoding(e))throw new TypeError('"encoding" must be a valid string encoding');var i=0|m(s,e),r=(t=n(t,i)).write(s,e);r!==i&&(t=t.slice(0,r));return t}(t,s,e):function(t,s){if(o.isBuffer(s)){var e=0|d(s.length);return 0===(t=n(t,e)).length?t:(s.copy(t,0,0,e),t)}if(s){if("undefined"!=typeof ArrayBuffer&&s.buffer instanceof ArrayBuffer||"length"in s)return"number"!=typeof s.length||(i=s.length)!=i?n(t,0):l(t,s);if("Buffer"===s.type&&a(s.data))return l(t,s.data)}var i;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,s)}function u(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function p(t,s){if(u(s),t=n(t,s<0?0:0|d(s)),!o.TYPED_ARRAY_SUPPORT)for(var e=0;e<s;++e)t[e]=0;return t}function l(t,s){var e=s.length<0?0:0|d(s.length);t=n(t,e);for(var i=0;i<e;i+=1)t[i]=255&s[i];return t}function d(t){if(t>=h())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+h().toString(16)+" bytes");return 0|t}function m(t,s){if(o.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var e=t.length;if(0===e)return 0;for(var i=!1;;)switch(s){case"ascii":case"latin1":case"binary":return e;case"utf8":case"utf-8":case void 0:return L(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*e;case"hex":return e>>>1;case"base64":return z(t).length;default:if(i)return L(t).length;s=(""+s).toLowerCase(),i=!0}}function g(t,s,e){var i=t[s];t[s]=t[e],t[e]=i}function f(t,s,e,i,r){if(0===t.length)return-1;if("string"==typeof e?(i=e,e=0):e>2147483647?e=2147483647:e<-2147483648&&(e=-2147483648),e=+e,isNaN(e)&&(e=r?0:t.length-1),e<0&&(e=t.length+e),e>=t.length){if(r)return-1;e=t.length-1}else if(e<0){if(!r)return-1;e=0}if("string"==typeof s&&(s=o.from(s,i)),o.isBuffer(s))return 0===s.length?-1:C(t,s,e,i,r);if("number"==typeof s)return s&=255,o.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(t,s,e):Uint8Array.prototype.lastIndexOf.call(t,s,e):C(t,[s],e,i,r);throw new TypeError("val must be string, number or Buffer")}function C(t,s,e,i,r){var a,h=1,n=t.length,o=s.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(t.length<2||s.length<2)return-1;h=2,n/=2,o/=2,e/=2}function c(t,s){return 1===h?t[s]:t.readUInt16BE(s*h)}if(r){var u=-1;for(a=e;a<n;a++)if(c(t,a)===c(s,-1===u?0:a-u)){if(-1===u&&(u=a),a-u+1===o)return u*h}else-1!==u&&(a-=a-u),u=-1}else for(e+o>n&&(e=n-o),a=e;a>=0;a--){for(var p=!0,l=0;l<o;l++)if(c(t,a+l)!==c(s,l)){p=!1;break}if(p)return a}return-1}function k(t,s,e,i){e=Number(e)||0;var r=t.length-e;i?(i=Number(i))>r&&(i=r):i=r;var a=s.length;if(a%2!=0)throw new TypeError("Invalid hex string");i>a/2&&(i=a/2);for(var h=0;h<i;++h){var n=parseInt(s.substr(2*h,2),16);if(isNaN(n))return h;t[e+h]=n}return h}function B(t,s,e,i){return V(L(s,t.length-e),t,e,i)}function y(t,s,e,i){return V(function(t){for(var s=[],e=0;e<t.length;++e)s.push(255&t.charCodeAt(e));return s}(s),t,e,i)}function S(t,s,e,i){return y(t,s,e,i)}function b(t,s,e,i){return V(z(s),t,e,i)}function R(t,s,e,i){return V(function(t,s){for(var e,i,r,a=[],h=0;h<t.length&&!((s-=2)<0);++h)e=t.charCodeAt(h),i=e>>8,r=e%256,a.push(r),a.push(i);return a}(s,t.length-e),t,e,i)}function P(t,s,e){return 0===s&&e===t.length?i.fromByteArray(t):i.fromByteArray(t.slice(s,e))}function _(t,s,e){e=Math.min(t.length,e);for(var i=[],r=s;r<e;){var a,h,n,o,c=t[r],u=null,p=c>239?4:c>223?3:c>191?2:1;if(r+p<=e)switch(p){case 1:c<128&&(u=c);break;case 2:128==(192&(a=t[r+1]))&&(o=(31&c)<<6|63&a)>127&&(u=o);break;case 3:a=t[r+1],h=t[r+2],128==(192&a)&&128==(192&h)&&(o=(15&c)<<12|(63&a)<<6|63&h)>2047&&(o<55296||o>57343)&&(u=o);break;case 4:a=t[r+1],h=t[r+2],n=t[r+3],128==(192&a)&&128==(192&h)&&128==(192&n)&&(o=(15&c)<<18|(63&a)<<12|(63&h)<<6|63&n)>65535&&o<1114112&&(u=o)}null===u?(u=65533,p=1):u>65535&&(u-=65536,i.push(u>>>10&1023|55296),u=56320|1023&u),i.push(u),r+=p}return function(t){var s=t.length;if(s<=A)return String.fromCharCode.apply(String,t);var e="",i=0;for(;i<s;)e+=String.fromCharCode.apply(String,t.slice(i,i+=A));return e}(i)}s.Buffer=o,s.SlowBuffer=function(t){+t!=t&&(t=0);return o.alloc(+t)},s.INSPECT_MAX_BYTES=50,o.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),s.kMaxLength=h(),o.poolSize=8192,o._augment=function(t){return t.__proto__=o.prototype,t},o.from=function(t,s,e){return c(null,t,s,e)},o.TYPED_ARRAY_SUPPORT&&(o.prototype.__proto__=Uint8Array.prototype,o.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&o[Symbol.species]===o&&Object.defineProperty(o,Symbol.species,{value:null,configurable:!0})),o.alloc=function(t,s,e){return function(t,s,e,i){return u(s),s<=0?n(t,s):void 0!==e?"string"==typeof i?n(t,s).fill(e,i):n(t,s).fill(e):n(t,s)}(null,t,s,e)},o.allocUnsafe=function(t){return p(null,t)},o.allocUnsafeSlow=function(t){return p(null,t)},o.isBuffer=function(t){return!(null==t||!t._isBuffer)},o.compare=function(t,s){if(!o.isBuffer(t)||!o.isBuffer(s))throw new TypeError("Arguments must be Buffers");if(t===s)return 0;for(var e=t.length,i=s.length,r=0,a=Math.min(e,i);r<a;++r)if(t[r]!==s[r]){e=t[r],i=s[r];break}return e<i?-1:i<e?1:0},o.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(t,s){if(!a(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return o.alloc(0);var e;if(void 0===s)for(s=0,e=0;e<t.length;++e)s+=t[e].length;var i=o.allocUnsafe(s),r=0;for(e=0;e<t.length;++e){var h=t[e];if(!o.isBuffer(h))throw new TypeError('"list" argument must be an Array of Buffers');h.copy(i,r),r+=h.length}return i},o.byteLength=m,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var s=0;s<t;s+=2)g(this,s,s+1);return this},o.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var s=0;s<t;s+=4)g(this,s,s+3),g(this,s+1,s+2);return this},o.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var s=0;s<t;s+=8)g(this,s,s+7),g(this,s+1,s+6),g(this,s+2,s+5),g(this,s+3,s+4);return this},o.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?_(this,0,t):function(t,s,e){var i=!1;if((void 0===s||s<0)&&(s=0),s>this.length)return"";if((void 0===e||e>this.length)&&(e=this.length),e<=0)return"";if((e>>>=0)<=(s>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return v(this,s,e);case"utf8":case"utf-8":return _(this,s,e);case"ascii":return M(this,s,e);case"latin1":case"binary":return w(this,s,e);case"base64":return P(this,s,e);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,s,e);default:if(i)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),i=!0}}.apply(this,arguments)},o.prototype.equals=function(t){if(!o.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===o.compare(this,t)},o.prototype.inspect=function(){var t="",e=s.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,e).match(/.{2}/g).join(" "),this.length>e&&(t+=" ... ")),"<Buffer "+t+">"},o.prototype.compare=function(t,s,e,i,r){if(!o.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===s&&(s=0),void 0===e&&(e=t?t.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),s<0||e>t.length||i<0||r>this.length)throw new RangeError("out of range index");if(i>=r&&s>=e)return 0;if(i>=r)return-1;if(s>=e)return 1;if(s>>>=0,e>>>=0,i>>>=0,r>>>=0,this===t)return 0;for(var a=r-i,h=e-s,n=Math.min(a,h),c=this.slice(i,r),u=t.slice(s,e),p=0;p<n;++p)if(c[p]!==u[p]){a=c[p],h=u[p];break}return a<h?-1:h<a?1:0},o.prototype.includes=function(t,s,e){return-1!==this.indexOf(t,s,e)},o.prototype.indexOf=function(t,s,e){return f(this,t,s,e,!0)},o.prototype.lastIndexOf=function(t,s,e){return f(this,t,s,e,!1)},o.prototype.write=function(t,s,e,i){if(void 0===s)i="utf8",e=this.length,s=0;else if(void 0===e&&"string"==typeof s)i=s,e=this.length,s=0;else{if(!isFinite(s))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");s|=0,isFinite(e)?(e|=0,void 0===i&&(i="utf8")):(i=e,e=void 0)}var r=this.length-s;if((void 0===e||e>r)&&(e=r),t.length>0&&(e<0||s<0)||s>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var a=!1;;)switch(i){case"hex":return k(this,t,s,e);case"utf8":case"utf-8":return B(this,t,s,e);case"ascii":return y(this,t,s,e);case"latin1":case"binary":return S(this,t,s,e);case"base64":return b(this,t,s,e);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,t,s,e);default:if(a)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),a=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var A=4096;function M(t,s,e){var i="";e=Math.min(t.length,e);for(var r=s;r<e;++r)i+=String.fromCharCode(127&t[r]);return i}function w(t,s,e){var i="";e=Math.min(t.length,e);for(var r=s;r<e;++r)i+=String.fromCharCode(t[r]);return i}function v(t,s,e){var i=t.length;(!s||s<0)&&(s=0),(!e||e<0||e>i)&&(e=i);for(var r="",a=s;a<e;++a)r+=Y(t[a]);return r}function E(t,s,e){for(var i=t.slice(s,e),r="",a=0;a<i.length;a+=2)r+=String.fromCharCode(i[a]+256*i[a+1]);return r}function I(t,s,e){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+s>e)throw new RangeError("Trying to access beyond buffer length")}function x(t,s,e,i,r,a){if(!o.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(s>r||s<a)throw new RangeError('"value" argument is out of bounds');if(e+i>t.length)throw new RangeError("Index out of range")}function U(t,s,e,i){s<0&&(s=65535+s+1);for(var r=0,a=Math.min(t.length-e,2);r<a;++r)t[e+r]=(s&255<<8*(i?r:1-r))>>>8*(i?r:1-r)}function T(t,s,e,i){s<0&&(s=4294967295+s+1);for(var r=0,a=Math.min(t.length-e,4);r<a;++r)t[e+r]=s>>>8*(i?r:3-r)&255}function O(t,s,e,i,r,a){if(e+i>t.length)throw new RangeError("Index out of range");if(e<0)throw new RangeError("Index out of range")}function N(t,s,e,i,a){return a||O(t,0,e,4),r.write(t,s,e,i,23,4),e+4}function F(t,s,e,i,a){return a||O(t,0,e,8),r.write(t,s,e,i,52,8),e+8}o.prototype.slice=function(t,s){var e,i=this.length;if(t=~~t,s=void 0===s?i:~~s,t<0?(t+=i)<0&&(t=0):t>i&&(t=i),s<0?(s+=i)<0&&(s=0):s>i&&(s=i),s<t&&(s=t),o.TYPED_ARRAY_SUPPORT)(e=this.subarray(t,s)).__proto__=o.prototype;else{var r=s-t;e=new o(r,void 0);for(var a=0;a<r;++a)e[a]=this[a+t]}return e},o.prototype.readUIntLE=function(t,s,e){t|=0,s|=0,e||I(t,s,this.length);for(var i=this[t],r=1,a=0;++a<s&&(r*=256);)i+=this[t+a]*r;return i},o.prototype.readUIntBE=function(t,s,e){t|=0,s|=0,e||I(t,s,this.length);for(var i=this[t+--s],r=1;s>0&&(r*=256);)i+=this[t+--s]*r;return i},o.prototype.readUInt8=function(t,s){return s||I(t,1,this.length),this[t]},o.prototype.readUInt16LE=function(t,s){return s||I(t,2,this.length),this[t]|this[t+1]<<8},o.prototype.readUInt16BE=function(t,s){return s||I(t,2,this.length),this[t]<<8|this[t+1]},o.prototype.readUInt32LE=function(t,s){return s||I(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},o.prototype.readUInt32BE=function(t,s){return s||I(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},o.prototype.readIntLE=function(t,s,e){t|=0,s|=0,e||I(t,s,this.length);for(var i=this[t],r=1,a=0;++a<s&&(r*=256);)i+=this[t+a]*r;return i>=(r*=128)&&(i-=Math.pow(2,8*s)),i},o.prototype.readIntBE=function(t,s,e){t|=0,s|=0,e||I(t,s,this.length);for(var i=s,r=1,a=this[t+--i];i>0&&(r*=256);)a+=this[t+--i]*r;return a>=(r*=128)&&(a-=Math.pow(2,8*s)),a},o.prototype.readInt8=function(t,s){return s||I(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},o.prototype.readInt16LE=function(t,s){s||I(t,2,this.length);var e=this[t]|this[t+1]<<8;return 32768&e?4294901760|e:e},o.prototype.readInt16BE=function(t,s){s||I(t,2,this.length);var e=this[t+1]|this[t]<<8;return 32768&e?4294901760|e:e},o.prototype.readInt32LE=function(t,s){return s||I(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},o.prototype.readInt32BE=function(t,s){return s||I(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},o.prototype.readFloatLE=function(t,s){return s||I(t,4,this.length),r.read(this,t,!0,23,4)},o.prototype.readFloatBE=function(t,s){return s||I(t,4,this.length),r.read(this,t,!1,23,4)},o.prototype.readDoubleLE=function(t,s){return s||I(t,8,this.length),r.read(this,t,!0,52,8)},o.prototype.readDoubleBE=function(t,s){return s||I(t,8,this.length),r.read(this,t,!1,52,8)},o.prototype.writeUIntLE=function(t,s,e,i){(t=+t,s|=0,e|=0,i)||x(this,t,s,e,Math.pow(2,8*e)-1,0);var r=1,a=0;for(this[s]=255&t;++a<e&&(r*=256);)this[s+a]=t/r&255;return s+e},o.prototype.writeUIntBE=function(t,s,e,i){(t=+t,s|=0,e|=0,i)||x(this,t,s,e,Math.pow(2,8*e)-1,0);var r=e-1,a=1;for(this[s+r]=255&t;--r>=0&&(a*=256);)this[s+r]=t/a&255;return s+e},o.prototype.writeUInt8=function(t,s,e){return t=+t,s|=0,e||x(this,t,s,1,255,0),o.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[s]=255&t,s+1},o.prototype.writeUInt16LE=function(t,s,e){return t=+t,s|=0,e||x(this,t,s,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[s]=255&t,this[s+1]=t>>>8):U(this,t,s,!0),s+2},o.prototype.writeUInt16BE=function(t,s,e){return t=+t,s|=0,e||x(this,t,s,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[s]=t>>>8,this[s+1]=255&t):U(this,t,s,!1),s+2},o.prototype.writeUInt32LE=function(t,s,e){return t=+t,s|=0,e||x(this,t,s,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[s+3]=t>>>24,this[s+2]=t>>>16,this[s+1]=t>>>8,this[s]=255&t):T(this,t,s,!0),s+4},o.prototype.writeUInt32BE=function(t,s,e){return t=+t,s|=0,e||x(this,t,s,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[s]=t>>>24,this[s+1]=t>>>16,this[s+2]=t>>>8,this[s+3]=255&t):T(this,t,s,!1),s+4},o.prototype.writeIntLE=function(t,s,e,i){if(t=+t,s|=0,!i){var r=Math.pow(2,8*e-1);x(this,t,s,e,r-1,-r)}var a=0,h=1,n=0;for(this[s]=255&t;++a<e&&(h*=256);)t<0&&0===n&&0!==this[s+a-1]&&(n=1),this[s+a]=(t/h>>0)-n&255;return s+e},o.prototype.writeIntBE=function(t,s,e,i){if(t=+t,s|=0,!i){var r=Math.pow(2,8*e-1);x(this,t,s,e,r-1,-r)}var a=e-1,h=1,n=0;for(this[s+a]=255&t;--a>=0&&(h*=256);)t<0&&0===n&&0!==this[s+a+1]&&(n=1),this[s+a]=(t/h>>0)-n&255;return s+e},o.prototype.writeInt8=function(t,s,e){return t=+t,s|=0,e||x(this,t,s,1,127,-128),o.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[s]=255&t,s+1},o.prototype.writeInt16LE=function(t,s,e){return t=+t,s|=0,e||x(this,t,s,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[s]=255&t,this[s+1]=t>>>8):U(this,t,s,!0),s+2},o.prototype.writeInt16BE=function(t,s,e){return t=+t,s|=0,e||x(this,t,s,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[s]=t>>>8,this[s+1]=255&t):U(this,t,s,!1),s+2},o.prototype.writeInt32LE=function(t,s,e){return t=+t,s|=0,e||x(this,t,s,4,2147483647,-2147483648),o.TYPED_ARRAY_SUPPORT?(this[s]=255&t,this[s+1]=t>>>8,this[s+2]=t>>>16,this[s+3]=t>>>24):T(this,t,s,!0),s+4},o.prototype.writeInt32BE=function(t,s,e){return t=+t,s|=0,e||x(this,t,s,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),o.TYPED_ARRAY_SUPPORT?(this[s]=t>>>24,this[s+1]=t>>>16,this[s+2]=t>>>8,this[s+3]=255&t):T(this,t,s,!1),s+4},o.prototype.writeFloatLE=function(t,s,e){return N(this,t,s,!0,e)},o.prototype.writeFloatBE=function(t,s,e){return N(this,t,s,!1,e)},o.prototype.writeDoubleLE=function(t,s,e){return F(this,t,s,!0,e)},o.prototype.writeDoubleBE=function(t,s,e){return F(this,t,s,!1,e)},o.prototype.copy=function(t,s,e,i){if(e||(e=0),i||0===i||(i=this.length),s>=t.length&&(s=t.length),s||(s=0),i>0&&i<e&&(i=e),i===e)return 0;if(0===t.length||0===this.length)return 0;if(s<0)throw new RangeError("targetStart out of bounds");if(e<0||e>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),t.length-s<i-e&&(i=t.length-s+e);var r,a=i-e;if(this===t&&e<s&&s<i)for(r=a-1;r>=0;--r)t[r+s]=this[r+e];else if(a<1e3||!o.TYPED_ARRAY_SUPPORT)for(r=0;r<a;++r)t[r+s]=this[r+e];else Uint8Array.prototype.set.call(t,this.subarray(e,e+a),s);return a},o.prototype.fill=function(t,s,e,i){if("string"==typeof t){if("string"==typeof s?(i=s,s=0,e=this.length):"string"==typeof e&&(i=e,e=this.length),1===t.length){var r=t.charCodeAt(0);r<256&&(t=r)}if(void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!o.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"==typeof t&&(t&=255);if(s<0||this.length<s||this.length<e)throw new RangeError("Out of range index");if(e<=s)return this;var a;if(s>>>=0,e=void 0===e?this.length:e>>>0,t||(t=0),"number"==typeof t)for(a=s;a<e;++a)this[a]=t;else{var h=o.isBuffer(t)?t:L(new o(t,i).toString()),n=h.length;for(a=0;a<e-s;++a)this[a+s]=h[a%n]}return this};var q=/[^+\/0-9A-Za-z-_]/g;function Y(t){return t<16?"0"+t.toString(16):t.toString(16)}function L(t,s){var e;s=s||1/0;for(var i=t.length,r=null,a=[],h=0;h<i;++h){if((e=t.charCodeAt(h))>55295&&e<57344){if(!r){if(e>56319){(s-=3)>-1&&a.push(239,191,189);continue}if(h+1===i){(s-=3)>-1&&a.push(239,191,189);continue}r=e;continue}if(e<56320){(s-=3)>-1&&a.push(239,191,189),r=e;continue}e=65536+(r-55296<<10|e-56320)}else r&&(s-=3)>-1&&a.push(239,191,189);if(r=null,e<128){if((s-=1)<0)break;a.push(e)}else if(e<2048){if((s-=2)<0)break;a.push(e>>6|192,63&e|128)}else if(e<65536){if((s-=3)<0)break;a.push(e>>12|224,e>>6&63|128,63&e|128)}else{if(!(e<1114112))throw new Error("Invalid code point");if((s-=4)<0)break;a.push(e>>18|240,e>>12&63|128,e>>6&63|128,63&e|128)}}return a}function z(t){return i.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(q,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function V(t,s,e,i){for(var r=0;r<i&&!(r+e>=s.length||r>=t.length);++r)s[r+e]=t[r];return r}}).call(s,e(42))},function(t,s){var e;e=function(){return this}();try{e=e||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(e=window)}t.exports=e},function(t,s,e){"use strict";s.byteLength=function(t){return 3*t.length/4-c(t)},s.toByteArray=function(t){var s,e,i,h,n,o=t.length;h=c(t),n=new a(3*o/4-h),e=h>0?o-4:o;var u=0;for(s=0;s<e;s+=4)i=r[t.charCodeAt(s)]<<18|r[t.charCodeAt(s+1)]<<12|r[t.charCodeAt(s+2)]<<6|r[t.charCodeAt(s+3)],n[u++]=i>>16&255,n[u++]=i>>8&255,n[u++]=255&i;2===h?(i=r[t.charCodeAt(s)]<<2|r[t.charCodeAt(s+1)]>>4,n[u++]=255&i):1===h&&(i=r[t.charCodeAt(s)]<<10|r[t.charCodeAt(s+1)]<<4|r[t.charCodeAt(s+2)]>>2,n[u++]=i>>8&255,n[u++]=255&i);return n},s.fromByteArray=function(t){for(var s,e=t.length,r=e%3,a="",h=[],n=0,o=e-r;n<o;n+=16383)h.push(u(t,n,n+16383>o?o:n+16383));1===r?(s=t[e-1],a+=i[s>>2],a+=i[s<<4&63],a+="=="):2===r&&(s=(t[e-2]<<8)+t[e-1],a+=i[s>>10],a+=i[s>>4&63],a+=i[s<<2&63],a+="=");return h.push(a),h.join("")};for(var i=[],r=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=0,o=h.length;n<o;++n)i[n]=h[n],r[h.charCodeAt(n)]=n;function c(t){var s=t.length;if(s%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===t[s-2]?2:"="===t[s-1]?1:0}function u(t,s,e){for(var r,a,h=[],n=s;n<e;n+=3)r=(t[n]<<16&16711680)+(t[n+1]<<8&65280)+(255&t[n+2]),h.push(i[(a=r)>>18&63]+i[a>>12&63]+i[a>>6&63]+i[63&a]);return h.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},function(t,s){s.read=function(t,s,e,i,r){var a,h,n=8*r-i-1,o=(1<<n)-1,c=o>>1,u=-7,p=e?r-1:0,l=e?-1:1,d=t[s+p];for(p+=l,a=d&(1<<-u)-1,d>>=-u,u+=n;u>0;a=256*a+t[s+p],p+=l,u-=8);for(h=a&(1<<-u)-1,a>>=-u,u+=i;u>0;h=256*h+t[s+p],p+=l,u-=8);if(0===a)a=1-c;else{if(a===o)return h?NaN:1/0*(d?-1:1);h+=Math.pow(2,i),a-=c}return(d?-1:1)*h*Math.pow(2,a-i)},s.write=function(t,s,e,i,r,a){var h,n,o,c=8*a-r-1,u=(1<<c)-1,p=u>>1,l=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,d=i?0:a-1,m=i?1:-1,g=s<0||0===s&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(n=isNaN(s)?1:0,h=u):(h=Math.floor(Math.log(s)/Math.LN2),s*(o=Math.pow(2,-h))<1&&(h--,o*=2),(s+=h+p>=1?l/o:l*Math.pow(2,1-p))*o>=2&&(h++,o/=2),h+p>=u?(n=0,h=u):h+p>=1?(n=(s*o-1)*Math.pow(2,r),h+=p):(n=s*Math.pow(2,p-1)*Math.pow(2,r),h=0));r>=8;t[e+d]=255&n,d+=m,n/=256,r-=8);for(h=h<<r|n,c+=r;c>0;t[e+d]=255&h,d+=m,h/=256,c-=8);t[e+d-m]|=128*g}},function(t,s){var e={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==e.call(t)}},function(t,e){t.exports=s}])});