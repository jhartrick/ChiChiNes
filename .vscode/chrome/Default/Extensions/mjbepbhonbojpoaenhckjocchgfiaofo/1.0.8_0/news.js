(function(){function p(){chrome.storage.local.get("news",function(c){c&&c.news&&(a=JSON.parse(c.news))})}function g(){chrome.storage.local.set({news:JSON.stringify(a)})}function l(){q(r)}function q(a){Registry.require(["engineapi"],function(){Registry.get("engineapi").getEngineStatus(function(d){a(d)})})}function r(c){try{console.log("checkNews: engineStatus",c);var d=chrome.runtime.getManifest().version;c&&0<c.version&&(m=c.version);var e=new XMLHttpRequest,b="http://awe-api.acestream.me/news/get?locale="+
chrome.i18n.getMessage("@@ui_locale")+"&appVersion="+d+"&engineVersion="+m+"&_="+Math.random();e.open("GET",b,!0);e.timeout=1E4;e.onreadystatechange=function(){if(4==e.readyState&&200==e.status)try{var b=!1,d=JSON.parse(e.responseText),c;for(c in d)a[c]||(a[c]=d[c],a[c].read=!1,b=!0);for(c in a)d[c]||(delete a[c],b=!0);b&&g()}catch(h){console.log("news:check: error: "+h)}};e.send()}catch(f){console.log("checkEngine: error: "+f)}window.setTimeout(l,144E5)}var n=!1,m=0,a={};Registry.register("news",
"58",{init:function(){n||(n=!0,p(),l())},getNewsForUrl:function(c){var d,e=[],b;for(b in a)if(!a[b].read){var f=!1;if(a[b].includes&&a[b].includes.length)for(d=0;d<a[b].includes.length;d++){var k=new RegExp(a[b].includes[d]);if(k.test(c)){f=!0;break}}else if(a[b].excludes&&a[b].excludes.length)for(f=!0,d=0;d<a[b].excludes.length;d++)if(k=new RegExp(a[b].excludes[d]),k.test(c)){f=!1;break}if(f){f=!0;if(a[b].excludeScripts&&a[b].excludeScripts.length){var g=Registry.get("storage"),h={};g.listValues().forEach(function(a){if(a.match("^"+
rea.FEATURES.CONSTANTS.PREFIX.META)){a=g.getValue(a);var b="";a.namespace&&(b=a.namespace+"/");b+=a.name;h[b]=1}});for(d=0;d<a[b].excludeScripts.length;d++)if(1===h[a[b].excludeScripts[d]]){f=!1;break}}f&&e.push({id:b,title:a[b].title,text:a[b].text,btnUrl:a[b].btnUrl,btnTitle:a[b].btnTitle})}}return e},markAsRead:function(c){a[c]&&!a[c].read&&(a[c].read=!0,g())}})})();
